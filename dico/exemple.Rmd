---
title: "Dico Dashboard"
output: 
  flexdashboard::flex_dashboard:
  orientation: columns
vertical_layout: fill
runtime: shiny
---

<!-- backlog 
  (+doublons techniques)
  # Evolution dans le temps (genre √† J-90) 
  # mod√®le orphelin (sans) rattachement √† des concept du dico==> Extraction des mod√®le.... 
  # donn√©es obsol√®te mais avec 
          - des lien vers des mod√®les IT ou 
          - des liens vers de mod√®les M√©tier ou 
          - avec des concept enfant ou 
          - avec des concept parents ou 
          - avec des r√®gle m√©tier
        pour information: avec processus m√©tier  (conso / producteur)
     * Par motif d'obsolesence
  # les terme qui sont synonyme d'eux m√™me 
    # les synonnyme qui ont leur propre d√©finition ... 
 +++ liste des donn√©es posant probl√®me
 
 [6/27/2022 6:43 PM]  LEVISTRE Laurent ResgTpsGdo:  
faut que tu me mettes un controle en place sur le nombre de r√®gles de gestion au regard de la criticit√© d'une donn√©e
plus la donn√©e est critique, quelque part plus tu devrais avoir un encadrement par de nombreuses r√®gles de gestion
 
[6/27/2022 6:49 PM]  
Yes 
compter le nombre de r√®gle par niveau CM1/2/3 
(et on doit en avoir plus en CM3)
 

 
 
-->
  
```{r setup, include=FALSE}


library(ECharts2Shiny)
library(flexdashboard)
library(binovisualfields)
library(shiny)
library(dplyr)
library(plotly)
library(summarytools)
library(kableExtra)
library(ngram)
library(arsenal)
library(stringr)
library (ggplot2)
library(multimode)
# install.packages("sqldf")
library("sqldf")
library(tidyverse)
library(htmltools)
library(lubridate)
Sys.setenv(JAVA_HOME="C:/Program Files/Java/jre1.8.0_251/") 
  library(rJava )
  library("xlsx")
  library(readxl)
library(glue)

  path<-"C:\\Users\\A311009\\OneDrive - GROUP DIGITAL WORKPLACE\\D_Drive_A311009\\GDO\\99-EXTRACT"
  setwd(path)

 options(shiny.maxRequestSize = 30*1024^2)
  
gris <- colorRampPalette(c("#E6E6E6","#BCBCBC")) #gris
bleu <- colorRampPalette(c("#D3F0FF","#D3D3FF")) #bleu
#bleu(6)[1]

  
histowc<- function(toto, rm1=FALSE, title = "Histogramme")
  {
  titi<-sapply(toto, wordcount, sep = " ")
  moy<- round(mean(titi, na.rm = T), 2)
  maxi<<- round(max(titi, na.rm = T), 2)
  mini<<- round(min(titi, na.rm = T), 2)
  isNA <<- sum(is.na(toto))
  nonNA <- sum(!is.na(toto))
  all <- isNA + nonNA
  titi<-titi[!is.na(titi) & !is.na(toto)]
  titi<-titi[(titi!=0)]
  nb1 <<- sum(titi==1)
  nb_court<<-sum(titi<5 & titi>1)
  nb_ok<<- sum(titi>4 & titi<11)
  nb_long <<-sum(titi>10)
  
  #print(summary(titi))
  if (rm1==TRUE) { 
    titi<-titi[(titi!=1)]
  }
  
  h<-hist(titi, main = paste (title,"\n", all, "donn√©es dont ", nonNA ,"non vides et",isNA, " vides") , breaks = 100,  
          xlab=paste("Nombre de Mots :\n minimum:",mini,"   ; moyenne:",moy, "   ; maximum:",maxi,"  ; dont 1 seul mot=",nb1) )

  x<-titi
  xfit<-seq(min(x),max(x),length=100)
  yfit<-dnorm(xfit,mean=mean(x),sd=sd(x))
  yfit <- yfit*diff(h$mids[1:2])*length(x)
 # lines(xfit, yfit, col="green", lwd=2)
  
      }

histolt <- function(toto, title = "Histogramme"){
titi<-nchar(toto)
moy<- round(mean(titi, na.rm = T), 2)
mini<- round(min(titi, na.rm = T), 2)
maxi<- round(max(titi, na.rm = T), 2)
isNA <- sum(is.na(titi))
nonNA <- sum(!is.na(titi))
all <- isNA + nonNA
  nb1 <- sum(titi==1)
  nb2 <- sum(titi==2)
#print(summary(titi))
  #barplot(titi)
h<-hist(titi, main = paste (title,"\n", all, "donn√©es dont ", nonNA ,"non vides et",isNA, " vides") , breaks = 100 , 
        xlab=paste("Nombre de lettres:\n minimum:",mini,"   ; moyenne:",moy, "; maximum:",maxi," ; 1 lettre:",nb1, " ; 2 lettres:",nb2))
                   
x<-titi[!is.na(titi)]
xfit<-seq(min(x),max(x),length=100)
yfit<-dnorm(xfit,mean=mean(x),sd=sd(x))
yfit <- yfit*diff(h$mids[1:2])*length(x)
# lines(xfit, yfit, col="blue", lwd=2) 

}

datedens<-function(date.x, text){
#date.x <-as.Date("1970-01-01")
# date.x<- date.o
# date.x <- lubridate::ymd_hms(date.x)
# date.x <- as.Date(date.x)    

by_month <- function(x,n=1){
  seq(min(x,na.rm=T),max(x,na.rm=T),by=paste0(n," months"))
}
# x<-substr(date.x, 1,10)
# x<- as.Date(x)
# x<- as.numeric(x, as.Date("1970-01-01")  , units="days")
# modes <- locmodes(x, mod0 = 1)
# plot(modes)
# at<-axTicks(1)
# axis(3,at,as.Date(at, origin=as.Date("1970-01-01"), units = "days"))
# text<-as.Date(modes$locations,origin=as.Date("1970-01-01"), units = "days")
# mtext(paste("MODE", text), side=3 )
#summary(date.x)
#hist(date.x, breaks = 80)

dfx<-as.data.frame(date.x)
if (sum(!is.na(dfx$date.x))>0)
{ggplot(dfx, aes(x=date.x)) +
    geom_histogram(aes(y=..density..),      # Histogram with density instead of count on y-axis
                   binwidth=30,
                   colour="black", fill="white") +
scale_x_date(labels = scales::date_format("%Y-%b"),
               breaks = by_month(dfx$date.x,2)) + 
      xlab(text) +
  theme(axis.text.x = element_text(angle=90))+
      geom_density(alpha=.3, fill="#32CD32")
}

}


xls_export = FALSE
compute_all = TRUE
reload= TRUE

transcoservice <-c("Service Business Data Designer", 	"SDD",
                   "CPLE/DTO - CPLE/DTO (43989SKR)",	"CPLE",
                   "DFIN/BDF/RDM - DFIN/BDF/RDM (9974SKR)",	"BDDF",
                   "DFIN/BDF/RDM/VDF - DFIN/BDF/RDM/VDF (10400SKR)",	"BDDF",
                   "DFIN/DTO/ETF - DFIN/DTO/ETF (43506SKR)",	"DFIN",
                   "DGLE/PIC - DGLE/PIC (38415SKR)",	"DGLE/PIC",
                   "GBSU/DAT/DMO - DMO (111610SKR)",	"GBSU",
                   "GBSU/DAT/DMO (0) - GBSU/DAT/DMO (0) (102373SKR)",	"GBSU",
                   "GSCRO/CPL/DTO - GSCRO/CPL/DTO (214452SKR)",	"CPLE",
                   "HRCO/DTS - HRCO/DTS (191556SKR)",	"HRCO",
                   "HRCO/PRO/ISM/DEF - HRCO/PRO/ISM/DEF (16979SKR)",	"HRCO",
                   "ITIM/PRF/DIR",	"RESG/GTS",
                   "RESG/ACH/DEF - RESG/ACH/DEF (14236SKR)",	"RESG/ACH",
                   "RESG/IMM/SEG/ORD - RESG/IMM/SEG/ORD (38527SKR)",	"RESG/IMM",
                   "RESG/IMM/TDD/TDD - RESG/IMM/TDD/TDD (226792SKR)",	"RESG/IMM",
                   "RESG/SGT/ETK - RESG/SGT/ETK (62193SKR)",	"RESG/SGT",
                   "RESG/TPS/API - RESG/TPS/API (9815SKR)",	"RESG/TPS/API",
                   "RESG/TPS/GDO - RESG/TPS/GDO (9836SKR)",	"RESG/TPS/GDO",
                   "RISQ/DTO - RISQ/DTO (9500SKR)", "RISQ/DTO",
                   "RISQ/PRO/HSM - RISQ/PRO/HSM (125445SKR)",	"RISQ/PRO",
                   "RISQ/RMA/MMG/DDO - RISQ/RMA/MMG/DDO (72723SKR)",	"RISQ/RMA",
                   "SEGL/CAO/MAP",	"SEGL",
                   "SEGL/CAO/MAP - SEGL/CAO/MAP (9789SKR)",	"SEGL",
                   "SGEBS/CPLE/DTO - SGEBS/CPLE/DTO (163046SKR)",	"CPLE",
                   "AFMO/BAN/SGA",	"OTHER", 
                   "Accounting Financial Systems",	"OTHER",
                   "BDDF/FRF/FAE - BDDF/FRF/FAE (9724SKR)",	"FRANFINANCE",
                   "COOS/DPM",	"GBSU",
                   "HRCO/PRO/SOL - HRCO/PRO/SOL (9860SKR)",	"HRCO",
                   "IBFS/EURO/CGI - CGI (368SKR)",	"CGI",
                   "ITIM/DSR/DMG/VDF - ITIM/DSR/DMG/VDF (153270SKR)",	"GTS",
                   "RESG/CFT/ARC/VDF - RESG/CFT/ARC/VDF (51528SKR)",	"GTS",
                   "RESG/GTS/TSI/GIS/VDF",	"GTS",
                   "GSCI/GBS/DAT/DQT - DQT (219315SKR)", "GBSU",
                   "GSCRO/DOM/COO/DTO - GSCRO/DOM/COO/DTO (214354SKR)","DFIN",
                   "RESG/GTS/OPM/RQD/VDF - RESG/GTS/OPM/RQD/VDF (205858SKR)","GTS",
                   "R√©f√©rence des UO pour les populations utilisatrices::ALDA - ALDA (314SKR)",	"OTHER",
                   "R√©f√©rence des UO pour les populations utilisatrices::FRANFINANCE - FRANFINANCE (94454SKR)",	"FRANFINANCE",
                   "REF",  "RESG/TPS/GDO/REF" ,
                   "GOV",  "RESG/TPS/GDO/GOV" ,
                   "PROT" ,"RESG/TPS/GDO/PROT" 
) 

dim(transcoservice)<- c( 2,length(transcoservice)/2  )
transcoservice<-t(transcoservice)
transcoservice<-as.data.frame(transcoservice)
colnames (transcoservice) <- transcoservice[1,]
transcoservice<-transcoservice [-1,]
colnames(transcoservice)[2]<-"SDD"
transcoservice[dim(transcoservice)[1]+1,]<- c('*', 'All')
DMO<-transcoservice[order(transcoservice$SDD),"SDD"]

unique (DMO)

colfunc <- colorRampPalette(c("#E6E6E6","#BCBCBC")) #gris
#colfunc(6)[1]
bleu <- colorRampPalette(c("#D3F0FF","#D3D3FF")) #bleu


computepct<- function(vari, df)
  { x<-NA
if (vari == "All")
  {
all_ok<-sum(
      !is.na(df$`R√®gles de gestion m√©tier (Anglais)` )#
    & !is.na(df$`R√®gles de gestion m√©tier (Fran√ßais)`)#
    & !is.na(df$`Liste de valeurs (Anglais)`) #
    & !is.na(df$`Liste de valeurs (Fran√ßais)`)#
    # ajouter qq chose pour nature de le conf pour C2/C3 : la r√®gle est ok si non C2/C3 ; et OK si C2/C3 est nature non vide
# dico_filtredmC2C3 = dico_filtredm[dico_filtredm$`Exigence de confidentialit√© par d√©faut pouvant √™tre modifi√©e selon l'usage` %in% c("C2", "C3"),]
# toto<-as.data.frame(table(dico_filtredmC2C3$`Nature de la confidentialit√©`))
  & (   !(df$`Exigence de confidentialit√© par d√©faut pouvant √™tre modifi√©e selon l'usage`  %in%  c("C2", "C3")) | 
        ( df$`Exigence de confidentialit√© par d√©faut pouvant √™tre modifi√©e selon l'usage`  %in%  c("C2", "C3") & 
            !is.na(df$`Nature de la confidentialit√©`) ) )
& (   !(df$`Exigence de confidentialit√© par d√©faut pouvant √™tre modifi√©e selon l'usage`  %in%  c("C2", "C3")) | 
        ( df$`Exigence de confidentialit√© par d√©faut pouvant √™tre modifi√©e selon l'usage`  %in%  c("C2", "C3") & 
            !is.na(df$`Confidentiality nature`) ) )

    & !is.na(df$`Exigence de confidentialit√© par d√©faut pouvant √™tre modifi√©e selon l'usage`) #
    & !is.na(df$`Processus consommateurs`) #  
    & !is.na(df$`Processus producteurs`) #
    & !is.na(df$`Nom Business Data Designer`) #
    & !is.na(df$`Service Business Data Designer`) #
    & !is.na(df$`Nom Owner`) #
    & !is.na(df$`Serv Owner`) #
    & !is.na(df$`Nom long domaine de donn√©es (Fran√ßais)`) #
    & !is.na(df$`Criticit√© m√©tier`) #
    & !is.na(df$`D√©finition (Anglais)`) #
    & !is.na(df$`D√©finition (Fran√ßais)`) # 
    & !is.na(df$`Terme (Anglais)`)  #
    & !is.na(df$`Terme (Fran√ßais)`)  ) #
all<- dim(df)[1]
x = round((all_ok/all), 4)*100
  }

if (vari == 'NBR') 
{x= dim(df)[1]}

  
if (vari == 'NBC2C3') 
{x= dim(df)[1]}
  
if (!(vari == 'NBR') & !(vari == 'NBC2C3')   &  !(vari == "All") & (length(df) >0) )

    {  col=which (colnames(df) == vari)
  titi = sum(is.na( df[,col]))
  toto = sum(!is.na(df[, col]))
  x = round(toto/(titi+toto), 4)*100
  }
  
  
if (vari == 'DDEQDO') 
{x = (1- sum(df$`Nom Business Data Designer` ==df$`Nom Owner` ) / length(dico_filtredm)) *100}
  
  
  return(as.numeric(x))
  }



  
  
listectrl<<- 
  c("NBR", "All", "DDEQDO", "NBC2C3"
  
  ,"Terme (Fran√ßais)"   
  ,"Terme (Anglais)"
  ,"D√©finition (Fran√ßais)"
  ,"D√©finition (Anglais)"
  
  ,"Criticit√© m√©tier"  
  ,"Nom long domaine de donn√©es (Fran√ßais)"
  ,"Serv Owner"  
  ,"Nom Owner" 
  ,"Service Business Data Designer"
  ,"Nom Business Data Designer"
  
  ,"Processus producteurs"
  ,"Processus consommateurs"
  
  ,"Exigence de confidentialit√© par d√©faut pouvant √™tre modifi√©e selon l'usage"
  
  ,"Nature de la confidentialit√©"
  ,"Confidentiality nature"
  ,"Liste de valeurs (Fran√ßais)"
  ,"Liste de valeurs (Anglais)"
  ,"R√®gles de gestion m√©tier (Fran√ßais)"
  ,"R√®gles de gestion m√©tier (Anglais)"
  
  )


valbox_control<- function(df, vari, text = "inc.")
{
  renderValueBox({
  x<-computepct (vari, df)
  if (x==100) {col <- "#DBFCB9"}
  if (x<100)  {col <- "#EBF6B9"}
  if (x<75)   {col <- "#FCF0B9"}
  if (x<50)   {col <- "#FCCCB9"}
  if (x<25)   {col <- "#D2D2D2"}
caption = HTML(paste ("<p style = 'font-size : 20px;color:black;'><b>", text ,"</b></p>" ))
value = paste( x," %" ) 
  vb<-valueBox(value=value,caption = caption, color=col)
return(vb)
  })
}







```




0- Select data  {data-orientation=column}
=====================================  

Column {}
-------------------------------------
```{r}

fileInput(inputId = "filedata",
        label = "Upload data. Choose csv file",
        accept = c(".xlsx")      )

selectInput(inputId = "selectedDMO",
        label = "Select DMO",
        choices =DMO      )

checkboxInput("Genfile", "Generate for all DMO", FALSE)


renderText({
    # if (   is.null(data())    ) {
    #   return(NULL)
    # }
    # AddFilter data 
    if (input$selectedDMO != "All") 
      {
      ({ input$selectedDMO})
      } 
    else  
    {    
     ({ "not filtered" })
    }
  })

#selectInput(inputId="categorical_variable", label = "Select Categorical Variable:", choices = Categorical.Variables, selected = Categorical.Variables[1])
#selectInput(inputId="numeric_variable", label = "Select Numeric Variable:", choices = Numeric.Variables, selected = Numeric.Variables[1])
```

```{r Prepare data}
data <- reactive({
  req(input$filedata)
  dico<-read_excel(input$filedata$datapath, sheet = 1,     guess_max = 4000)
  
  # preparation des variables 
  dico$portee<-as.vector(dico$Port√©e)
  #levels(dico$portee)
  dico$portee[is.na(dico$Port√©e)]<-"NA"
  dico$portee<-recode_factor(dico$portee , "Groupe"= "Groupe" ,    "Privative banque d'investissement"= "SGCIB"  , 
                             "Privative Banque et financements √† l'international" = "IBFS" ,   "Privative Banque de r√©seau France (SG)"=  "RBDF" )
  
  
  dico$`Statut de validation`[is.na(dico$`Statut de validation`)]<-"N/A"
  #unique(dico$`Statut de validation`)
  #table(dico$status_val)
  dico$status_val <-recode_factor(dico$`Statut de validation`, 
                                  "Non valid√©"  = "No Valid", 
                                  "N/A"="N/A",   
                                  "Valid√© par le data designer"  = "Valid DD", 
                                  "Valid√© par le data owner" = "Valid DO")
  dico$`Statut de diffusion`[is.na(dico$`Statut de diffusion`)]<-"N/A"
  dico$status_dif<- dico$`Statut de diffusion`
  
  
  dico$Obsol√®te[is.na(dico$Obsol√®te)]<-"N/A"
  dico$Obsol√®te<-recode_factor(dico$Obsol√®te,
                                "Oui"  = "Obsol√®te", 
                                "N/A"="N/A",   
                                "Non" = "Non Obsol√®te")
  
  
  dico$Nature <- ordered (dico$Nature, levels = c("Donn√©e m√©tier", "Objet m√©tier",  "Concept" ))
  
  # prepare DATA that is read
  dico_all_sdd<-sqldf("select A.* , B.SDD from dico A left join  transcoservice B 
                      on  A.`Service Business Data Designer` = B.`Service Business Data Designer` ") 
  #subspit de GDO
  dico_all_sdd[dico_all_sdd$SDD == "RESG/TPS/GDO" & !is.na (dico_all_sdd$SDD) & (dico_all_sdd$`Nom Business Data Designer` == "PREVOST Madeleine"),]$SDD<-  "RESG/TPS/GDO/REF" 
  dico_all_sdd[dico_all_sdd$SDD == "RESG/TPS/GDO" & !is.na (dico_all_sdd$SDD) &  dico_all_sdd$`Nom Business Data Designer` == "BOUZNIR Soufia",]$SDD <-  "RESG/TPS/GDO/GOV" 
  dico_all_sdd[dico_all_sdd$SDD == "RESG/TPS/GDO" & !is.na (dico_all_sdd$SDD) &  dico_all_sdd$`Nom Business Data Designer` == "TEMIM David",]$SDD <-  "RESG/TPS/GDO/PROT" 
  
  dico_all_sdd<<-dico_all_sdd
  
  # retirer les doublons de CM
  cm_col=which (colnames(dico_all_sdd) == "Criticit√© m√©tier")
  # dfcmx<- as.data.frame (cbind(dico_all_sdd$`Concept ADD` ,dico_all_sdd$`Identifiant technique`, dico_all_sdd$`Criticit√© m√©tier`))
  # colnames(dfcmx)[1]<-"Concept ADD"
  # colnames(dfcmx)[2]<-"Identifiant technique"
  # colnames(dfcmx)[3]<-"CMX"
  dico_nocm <- dico_all_sdd[,-cm_col]
  dico_nocmunique <- sqldf("select distinct * from dico_nocm")
  doublon<-sqldf("select A.`Identifiant technique`,  count(*) as nombre
              from dico A
              group by A.`Identifiant technique`
              having nombre>1 order by A.`Identifiant technique`")
  doublon_cm <- sqldf("select A.*,  B.`Criticit√© m√©tier` as `Criticit√© m√©tier`
                      from   doublon A, dico B
                      where A.`Identifiant technique` = B.`Identifiant technique` ")

  dico_dedoubl<- sqldf("select distinct  A.*, max(B.`Criticit√© m√©tier`) as `Criticit√© m√©tier` from dico_nocm A, doublon_cm B
                     where A.`Identifiant technique`   = B.`Identifiant technique`
                     group by A.`Identifiant technique`       ")
  dico_cmok <- sqldf("select  * from dico_all_sdd
                where `Identifiant technique` not in (select B.`Identifiant technique` from doublon B)")
  dico_cmok  <-cbind(dico_cmok [,-cm_col], dico_cmok [,cm_col]) # METTRE LE   CRITICIT2 M2TIER √† la fin
  lastcol = which (colnames(dico_cmok) == "dico_cmok[, cm_col]" )
  colnames(dico_cmok)[lastcol] <-"Criticit√© m√©tier"

  dico_all<-rbind(dico_cmok, dico_dedoubl)

  dico_all_sdd <-as.data.frame(dico_all)

  return(dico_all_sdd)
  
  
  
})

dataCDCP <-reactive({
  dico_all_sdd<-dataf()
  dfcdcp<-as.data.frame (cbind(dico_all_sdd$`Concept ADD` ,dico_all_sdd$`Identifiant technique`, dico_all_sdd$`Cat√©gorie de donn√©e √† caract√®re prioritaire`))
  colnames(dfcdcp)[1]<-"Concept ADD"
  colnames(dfcdcp)[2]<-"Identifiant technique"
  colnames(dfcdcp)[3]<-"CDCP"
  dfcdcp2<-dfcdcp %>% separate_rows(CDCP,sep=';')
  dfcdcp2$CDCP[is.na(dfcdcp2$CDCP)]<-"NA"
  return (dfcdcp2)
})



dataf <- reactive({
  dico_all<-data()
  if (input$selectedDMO != "All") 
  {
    datafiltre <- dico_all[dico_all$SDD == input$selectedDMO, ]
  } 
  else  
  {    
    datafiltre <- dico_all[, ]
  }
  return(datafiltre)
})


datafgv <- reactive({
  dicof <- dataf()
  dico_filtre<- sqldf("select * from dicof where Port√©e = 'Groupe' and status_val <> 'N/A' and  status_val <> 'No Valid'") 
  return(dico_filtre)
})



dataCDCPfgv <-reactive({
  dico_all_sdd<-datafgv()
  dfcdcp<-as.data.frame (cbind(dico_all_sdd$`Concept ADD` ,dico_all_sdd$`Identifiant technique`, dico_all_sdd$`Cat√©gorie de donn√©e √† caract√®re prioritaire`))
  colnames(dfcdcp)[1]<-"Concept ADD"
  colnames(dfcdcp)[2]<-"Identifiant technique"
  colnames(dfcdcp)[3]<-"CDCP"
  dfcdcp2<-dfcdcp %>% separate_rows(CDCP,sep=';')
  dfcdcp2$CDCP[is.na(dfcdcp2$CDCP)]<-"NA"
  return (dfcdcp2)
})

datafgvno <- reactive({
  dicofgv <- datafgv()
  dico_filtre<- sqldf("select * from dicofgv where Obsol√®te ='Non Obsol√®te'") 
  return(dico_filtre)
})

datafgvnod <- reactive({
  dicofgvno <- datafgvno()
  dico_filtre<- sqldf("select * from dicofgvno where status_dif = 'Oui'") 
  return(dico_filtre)
})


datafgvnond<- reactive({
  dicofgvno <- datafgvno()
  dico_filtre<- sqldf("select * from dicofgvno where status_dif = 'Non'") 
  return(dico_filtre)
})

datafgvob<- reactive({
  dicofgv <- datafgv()
  dico_filtre<- sqldf("select * from dicofgv where Obsol√®te ='Obsol√®te'") 
  return(dico_filtre)
})


dicodifval<- reactive({ 
  dico <- dataf()
  dico_difval <- as.data.frame.matrix(format(addmargins(table(dico$status_dif, dico$status_val)), digits =1))
  return (dico_difval)
})

dicodifobs<- reactive({
  dico<- dataf()
  dico_difval<-as.data.frame.matrix(format(addmargins(table(dico$status_dif, dico$Obsol√®te)), digits =1))
  return (dico_difval)
})
  
  
  PADIFVAL <-reactive({ 
    dico <- dataf()
    df<-table(dico$status_dif, dico$status_val)
    df2<-as.data.frame(df)
    filtre_dif <- (df2$Var1=="Oui")
    filtre_val <- (df2$Var2 %in% c("Valid DD", "Valid DO"))
    VD  <- sum(0, df2[ filtre_dif &  filtre_val ,]$Freq, na.rm = TRUE)
    NVD <- sum(0, df2[ filtre_dif & !filtre_val ,]$Freq, na.rm = TRUE)
    VND <- sum(0, df2[!filtre_dif &  filtre_val ,]$Freq, na.rm = TRUE)
    NVND <-sum(0, df2[!filtre_dif & !filtre_val ,]$Freq, na.rm = TRUE)
    return (c(NVND , VND,NVD,VD))
  })
  
PADIFOBS <-reactive({ 
    dico <- dataf()
    df<- table(dico$status_dif, dico$Obsol√®te) 
    OD<-df["Oui", "Obsol√®te" ] 
    OND<-df["Non", "Obsol√®te" ] 
    NOND<-df["Non", "Non Obsol√®te" ] 
    NOD<-df["Oui", "Non Obsol√®te" ] 
    return (c(OD , OND , NOND , NOD) )
})

date_all <- reactive({
  dico_filtre <- datafgv()
  date.v<-as.Date(dico_filtre$`Date validation`)
date.o<-as.Date(dico_filtre$`Date d'obsolescence`)
date.c<-as.Date(dico_filtre$`Date de cr√©ation`) 
date.m<-as.Date(dico_filtre$`Date de modification`)
date.all<-data.frame(date.c, date.m, date.v,date.o)
return(date.all)
  
})


datafgvC2C3 <- reactive({
    dicofgv <- datafgv()
    dico_filtreC2C3<- dicofgv[dicofgv$`Exigence de confidentialit√© par d√©faut pouvant √™tre modifi√©e selon l'usage` %in% c("C2", "C3"),]
    return(dico_filtreC2C3)
  })
      

moyenne<- reactive({
  dico_filtredm<- datafgv()
  dico_filtreC2C3 <- dico_filtredm[dico_filtredm$`Exigence de confidentialit√© par d√©faut pouvant √™tre modifi√©e selon l'usage` %in% c("C2", "C3"),]
  resu_v <-c()
  for (vari in listectrl[-c(1:4)] )
  {
    resu_v  = c(resu_v,"tbd")
    if (vari%in% c( "Nature de la confidentialit√©" ,"Confidentiality nature",  "NBC2C3") ) {dico_df<-dico_filtreC2C3} else {dico_df<-dico_filtredm}
    if (dim(dico_df)[1]>0)
    { col=which (colnames(dico_df) == vari)
      titi = sum(is.na( dico_df[,col]))
      toto = sum(!is.na(dico_df[, col]))
      x = round(toto/(titi+toto), 4)*100
      resu <- computepct(vari,dico_df)
      resu_v[length(resu_v)] <- resu}
  }
    comp_moy = mean(as.numeric(resu_v))  
   return(comp_moy)
})


```


1- Avant filtre donn√©es groupe valides (DGV) {data-orientation=rows}
=====================================  
Row {data-height=100}
-------------------------------------
### scope
```{r}
renderValueBox({
  scope<-input$selectedDMO
  valueBox(scope,caption = "SCOPE", color=bleu(8)[1], icon = "fa-glasses")
})


```

### NBRE DONNEES ALL
```{r}
renderValueBox({
    dataset <- dataf()
    #dataf <- dataf()
   nbrdata<-dim(dataset)[1]
  valueBox(nbrdata, caption = HTML("<b><u>Assiette pour cet √©cran: Nombre de Donn√©es total</b></u>" ) ,color=bleu(8)[2], icon = "fa-database")
      })
   
```

### NBRE DONNEES GRPE Valide
```{r}
renderValueBox({
  dataset <- datafgv()
  nbrdatafiltre<-dim(dataset)[1]
  valueBox(nbrdatafiltre, caption = "Parmi lesquelles : Donn√©es 'groupe' valides", color=bleu(8)[4], icon = "fa-award")
    })
```

### NBRE DONNEES GRPE Valide non obsol√®te 
```{r}
renderValueBox({
  dataset<-datafgvno()
   nbrdatafiltreno<-dim(dataset)[1]
  valueBox(nbrdatafiltreno, caption = "Parmi lesquelles : Donn√©es 'groupe' valides non obsol√®tes", color=bleu(8)[5], icon = "fa-sun")
})
```

### NBRE DONNEES GRPE Valide NO diffus√©e 
```{r}
renderValueBox({
   dataset<-datafgvnod()
   nbrdatafiltrenod<-dim(dataset)[1]
  valueBox(nbrdatafiltrenod, caption = "et Parmi lesquelles : Donn√©es 'groupe' valides non obsol√®tes diffus√©es", color=bleu(8)[6], icon = "fa-signal")
})
```

### NBRE DONNEES GRPE Valide NO et NON diffus√©e 
```{r}
renderValueBox({
  dataset<-datafgvnond()
  nbrdatafiltrenond<-dim(dataset)[1]
    valueBox(nbrdatafiltrenond, caption = "et Parmi lesquelles : Donn√©es 'groupe' valides non obsol√®tes non diffus√©es", color = bleu(8)[7], icon = "fa-deaf")
})
```


### NBRE DONNEES GRPE Valide obsol√®te 
```{r}
renderValueBox({
  dataset<-datafgvob()
  nbrdatafiltreob<-dim(dataset)[1]
  valueBox(nbrdatafiltreob, caption = "et Parmi lesquelles : Donn√©es 'groupe' valides obsol√®tes", color=bleu(8)[8], icon = "fa-trash")
})
```



Row {data-height=150}
-------------------------------------
### Diffusion et validation des donn√©es
```{r}
renderTable({
  dicodifval()
   }, rownames = TRUE)
```

### Points d'attention sur diffusion et validation
```{r}
 renderUI ({
padifval<-PADIFVAL()
sep="<br>"
p1=glue('<b>Situation √† surveiller : {padifval[3]} donn√©es <u>non valid√©es et diffus√©es</u></b>')
p2="=> peut venir du besoin de faire connaitre la donn√©e avant sa validation formelle"
p3=glue("<b>Situation √† surveiller : {padifval[2]} donn√©es <u>valid√©es et non diffus√©es</u></b>")
p4="=> peut venir d'une donn√©e en cours de non diffus√©e dans l'attente de fin de projet"
p5=glue("<br>Situation normale : les {padifval[4]} donn√©es <u>valid√©es et diffus√©es</u>")
p6=glue("Situation normale : les {padifval[1]} donn√©es <u>non valid√©es et non diffus√©es</u>(en cours de saisie)")
text<-paste(p1,p2,p3,p4,p5,p6,sep=sep )
HTML (text)
})
```



### Diffusion et obsolescence des donn√©es
```{r}
renderTable({
  dicodifobs()
   }, rownames = TRUE)
```


### Points d'attention sur diffusion et obsolescence
```{r}
renderUI ({
  padifobs<-PADIFOBS()
  sep="<br>"
  p1 =glue('<b>Situation √† corriger : {padifobs[1]} donn√©es <u>obsol√®te et diffus√©es</u></b>')
  p2 ="=> les donn√©es obsol√®tes ne devraient pas √™tre diffus√©es, <u>√† corriger</u>"
  p3 =glue('<b>Situation √† surveiller : {padifobs[3]} donn√©es  <u>non obsol√®te et non diffus√©es</u></b>')
  p4 ="=> peut venir d'une donn√©e en cours de non diffus√©e dans l'attente de fin de projet"
  p5 =glue('Situation normale : les {padifobs[2]} donn√©es <u>obsol√®tes et non diffus√©es</u>(donn√©e en fin de vie) ')
  p6 =glue('Situation normale : les {padifobs[4]} donn√©es <u>non obsol√®tes et diffus√©es</u>')
  text<-paste(p1,p2,p3,p4,p5,p6,sep=sep )
  HTML (text)
})
```


Row {data-height=200}
-------------------------------------
### Port√©e parmi donn√©es total 
```{r}
  renderPlot({
  dico<-dataf()
    x <- barplot(table(dico$portee), xaxt="n")
    labs <- paste(names(table(dico$portee)),"\n", table(dico$portee))
    text(cex=1, x=x, y= 100, labs, xpd=TRUE)
})
```

### Validation parmi donn√©es total 
```{r}
  renderPlot({
      dico<-dataf()
x <- barplot(table(dico$status_val), xaxt="n")
labs <- paste(names(table(dico$status_val)), "\n",table(dico$status_val))
text(cex=1, x=x,  y=100, labs, xpd=TRUE)
})
```

### Diffusion parmi donn√©es total 
```{r}
 renderPlot({
      dico<-dataf()
    x <- barplot(table(dico$status_dif), xaxt="n")
    labs <- paste(names(table(dico$status_dif)), "\n",table(dico$status_dif))
    text(cex=1, x=x, y=100, labs, xpd=TRUE)
})
```

### Obsol√®te parmi donn√©es total 
```{r}
 renderPlot({
      dico<-dataf()
  x <- barplot(table(dico$Obsol√®te), xaxt="n") 
  labs <- paste(names(table(dico$Obsol√®te)), "\n",table(dico$Obsol√®te)) 
  text(cex=1, x=x, y=100, labs, xpd=TRUE)
 })
```



2- G√©n√©ralit√©s (DGV) {data-orientation=rows}
=====================================  
Row {data-height=100}
-------------------------------------
### Is the SCOPE
```{r}
renderValueBox({
  scope<-input$selectedDMO
  valueBox(scope,caption = "SCOPE", color=bleu(8)[1], icon = "fa-glasses")
})

```


### NBRE DONNEES ALL
```{r}
renderValueBox({
    dataset <- dataf()
    nbrdata<-dim(dataset)[1] 
  valueBox(nbrdata, caption = "Pour m√©moire : Nbr Donn√©es total",color=bleu(4)[2], icon = "fa-database")
})
```


### NBRE DONNEES GRPE Valide
```{r}
renderValueBox({
    dataset <- datafgv()
    nbrdatafiltre<-dim(dataset)[1] 
    valueBox (HTML(paste("<b><u>",nbrdatafiltre,"</b></u>")) , caption = HTML("<b><u>Assiette pour cet √©cran : Donn√©es groupe valide</b></u>"), color=bleu(4)[3], icon = "fa-award")
  })
```


### NBRE DONNEES GRPE Valide NO diffus√©e
```{r}
renderValueBox({
    dataset <- datafgvnod()
    nbrdatafiltrenod<-dim(dataset)[1] 
    valueBox(nbrdatafiltrenod, caption = "Pour info :  Donn√©es groupe valide non OBSOLETE diffus√©e", color=bleu(4)[4], icon = "fa-signal")
  })
```


Row {data-height=600}
-------------------------------------
### Nature de la donn√©e
```{r}
renderPlot({
  dico_filtre<-datafgv()
  dico_filtre$Nature <- ordered (dico_filtre$Nature, levels = c("Donn√©e m√©tier", "Objet m√©tier",  "Concept" ))
  x <- barplot(table(dico_filtre$Nature), xaxt="n")
  labs <- paste(names(table(dico_filtre$Nature)),"\n", table(dico_filtre$Nature))
  text(cex=1, x=x, y= 100, labs, xpd=TRUE)
}  
)

renderTable({
  dico_filtre<-datafgv()
  dico_filtre$Nature <- ordered (dico_filtre$Nature, levels = c("Donn√©e m√©tier", "Objet m√©tier",  "Concept" ))
  head(table(dico_filtre$Nature),4) 
   }, rownames = TRUE)
```


### Cat√©gorie de donn√©e Prioritaire
```{r}
renderPlot({
    cdcp_filtre<-dataCDCPfgv() #abord filtrer DGV //// 
    #dico$`Cat√©gorie de donn√©e √† caract√®re prioritaire`[is.na(dico$`Cat√©gorie de donn√©e √† caract√®re prioritaire`)]<-"NA"
    toto<-table(cdcp_filtre$CDCP)
    titi<-toto[order(-toto)]
    if (length(titi) > 1) 
      {x<-barplot(titi [-1] ,  xaxt="n")
      labs <- paste( titi [-1])
      text(cex=1, x=x, y= 100, labs, xpd=TRUE) 
      }
    })


renderTable({
  cdcp_filtre<-dataCDCPfgv() #abord filtrer DGV ////  
  toto<-table(cdcp_filtre$CDCP)
  titi<-toto[order(-toto)]
  head(titi,10) 
   }, rownames = TRUE
  )
```

### Cat√©gorie de donn√©e Personnelle
<!-- if pour g√©rer le cas ou  le il n'y a aucune CDCPerso -->
```{r}
renderPlot({
  dico_filtre<-datafgv()
    dico_filtre$`Cat√©gorie de donn√©e √† caract√®re personnel`[is.na(dico_filtre$`Cat√©gorie de donn√©e √† caract√®re personnel`)]<-"NA"
    toto<-table(dico_filtre$`Cat√©gorie de donn√©e √† caract√®re personnel`)
    titi<-toto[order(-toto)]
    if (length(titi)>1) {
    barplot(titi[-1] , cex.names=.5,las = 3) }
})


renderTable({
  dico_filtre<-datafgv()
    dico_filtre$`Cat√©gorie de donn√©e √† caract√®re personnel`[is.na(dico_filtre$`Cat√©gorie de donn√©e √† caract√®re personnel`)]<-"NA"
    toto<-table(dico_filtre$`Cat√©gorie de donn√©e √† caract√®re personnel`)
    titi<-toto[order(-toto)]
  titi
   }, rownames = TRUE
  )

```


3-Confidentialit√©/Criticit√© (DGV) {data-orientation=rows}
=====================================  
Row {data-height=100}
-------------------------------------
### Is the SCOPE
```{r}
renderValueBox({
  scope<-input$selectedDMO
  valueBox(scope,caption = "SCOPE", color=bleu(8)[1], icon = "fa-glasses")
})

```


### NBRE DONNEES ALL
```{r}
renderValueBox({
    dataset <- dataf()
    nbrdata<-dim(dataset)[1] 
  valueBox(nbrdata, caption = "Pour m√©moire : Nbr Donn√©es total",color=bleu(4)[2], icon = "fa-database")
})
```


### NBRE DONNEES GRPE Valide
```{r}
renderValueBox({
    dataset <- datafgv()
    nbrdatafiltre<-dim(dataset)[1] 
    valueBox (HTML(paste("<b><u>",nbrdatafiltre,"</b></u>")) , caption = HTML("<b><u>Assiette pour cet √©cran : Donn√©es groupe valide</b></u>"), color=bleu(4)[3], icon = "fa-award")
  })
```


### NBRE DONNEES GRPE Valide NO diffus√©e
```{r}
renderValueBox({
    dataset <- datafgvnod()
    nbrdatafiltrenod<-dim(dataset)[1] 
    valueBox(nbrdatafiltrenod, caption = "Pour info :  Donn√©es groupe valide non OBSOLETE diffus√©e", color=bleu(4)[4], icon = "fa-signal")
  })
```



Row {data-height=350}
-------------------------------------

### Confidentialit√©
```{r}
renderPlot({
  dico_filtre<-datafgv()
  barplot(table(dico_filtre$`Exigence de confidentialit√© par d√©faut pouvant √™tre modifi√©e selon l'usage`) , cex.names=1) 
})
```  


### Nature Confidentialit√© en Fran√ßais
```{r}

renderPlot ({
  dico_filtre<-datafgv()
  toto<-dico_filtre$`Nature de la confidentialit√©`[dico_filtre$`Exigence de confidentialit√© par d√©faut pouvant √™tre modifi√©e selon l'usage` %in% c("C2", "C3")]
  titi<-toto[!is.na(toto)]
  if (length(titi)>0 )
  {histowc(toto, rm1= FALSE, title = "Nombre de mots de \n la nature de confidentialit√© (Fran√ßais) pour les C2/C3")}
  # nb1 <<- sum(titi==1)
  # nb_court<<-sum(titi<5 & titi>1)
  # nb_ok<<- sum(titi>4 & titi<11)
  # nb_long <<-sum(titi>10)
  # isNA
})

```




### Nature Confidentialit√© en Anglais
```{r}
renderPlot ({
  dico_filtre<-datafgv()
  toto<-dico_filtre$`Confidentiality nature`[dico_filtre$`Exigence de confidentialit√© par d√©faut pouvant √™tre modifi√©e selon l'usage` %in% c("C2", "C3")]
  titi<-toto[!is.na(toto)]
  if (length(titi)>0 )
  {histowc(toto, rm1= FALSE, title = "Nombre de mots de \n la nature de confidentialit√© (Anglais) pour les C2/C3")}
})

```   


### Criticit√©
```{r}
renderPlot ({
  dico_filtre<-datafgv()
  #toto<-dico_filtre$`Cricit√© m√©tier`
  dico_filtre$`Criticit√© m√©tier` <- ordered (dico_filtre$`Criticit√© m√©tier`, levels = c("CM0","CM1","CM2","CM3"))
  dico_filtre$`Criticit√© m√©tier`[is.na(dico_filtre$`Criticit√© m√©tier`)]<-"N/A"
  toto <- ordered (dico_filtre$`Criticit√© m√©tier`, levels = c("CM0","CM1","CM2","CM3"))
  barplot(table(toto) , cex.names=1) 
  
})

```   


### Criticit√© et r√®gles m√©tier FR/EN
```{r}
renderPlotly({
    dico_filtre<- datafgv()
    #compter les RM
    toto<-dico_filtre
  toto$RM_FR<-  str_count(toto$`R√®gles de gestion m√©tier (Fran√ßais)`, "\n")+1
  toto$RM_FR[is.na(toto$`R√®gles de gestion m√©tier (Fran√ßais)`)]<-0
  toto$RM_EN<-  str_count(toto$`R√®gles de gestion m√©tier (Anglais)`, "\n")+1
  toto$RM_EN[is.na(toto$`R√®gles de gestion m√©tier (Anglais)`)]<-0
  titi<-data.frame(toto$`Criticit√© m√©tier`,  toto$RM_FR, toto$RM_EN)
  colnames(titi) <- c('CM','RM_FR','RM_EN')
 tata<-sqldf("select CM,RM_FR,RM_EN , count (*) as NBRE from titi group by CM,RM_FR,RM_EN"  )
  longueur <- dim(tata)[1]
  #plot(titiF$RM+rnorm(longueur),titiE$RM+rnorm(longueur), col=toto$`Criticit√© m√©tier`, pch = 20, cex= 0.1)
  #legend(30, 10, legend=levels(toto$`Criticit√© m√©tier`),        col=c(1:4), pch =20, cex=1)
pal <- c("red", "blue", "green")
  plot_ly(tata, x = tata$RM_FR+rnorm(longueur)*0.2, y = tata$RM_EN+rnorm(longueur)*0.2,  type = 'scatter',
       mode = "markers", color = tata$CM , size =tata$NBRE*2,  colors = pal, symbol = tata$CM, symbols = c('circle','x','0')) %>%
    layout(shapes = list(list(
    type = "line", 
    x0 = 0, 
    x1 = max(tata$RM_EN, tata$RM_FR), 
    xref = "x",
    y0 = 0, 
    y1 = max(tata$RM_EN, tata$RM_FR),
    yref = "y",
    line = list(color = "blue")
  )))
    
})
```




Row {data-height=350}
-------------------------------------

### Confidentialit√©
```{r}
renderTable({
  dico_filtre<-datafgv()
    toto<-table(dico_filtre$`Exigence de confidentialit√© par d√©faut pouvant √™tre modifi√©e selon l'usage`)
    toto
   }, rownames = TRUE
  )

```

### Points d'attention sur Confidentialit√© en Fran√ßais
```{r}
sliderInput("range", "Tranche de  valeurs acceptables",
                  min = 1, max = 500,
                  value = c(20,50), width = "100%")


renderUI ({
  dico_filtre<- datafgv()
  toto<-dico_filtre[dico_filtre$`Exigence de confidentialit√© par d√©faut pouvant √™tre modifi√©e selon l'usage` %in% c("C2", "C3"), ]$`Nature de la confidentialit√©`
      #isNA<-0 
      nb1<-0
      nb_ok<-0
      nb_court<-0
      nb_long<-0

    if (length(toto)>0)
    {
      minlg<-input$range[1]
      maxlg<-input$range[2]
      titi<-sapply(toto, wordcount, sep = " ")
      moy<- round(mean(titi, na.rm = T), 2)
      maxi<- round(max(titi, na.rm = T), 2)
      mini<- round(min(titi, na.rm = T), 2)
      isNA <- sum(is.na(toto))
      nonNA <- sum(!is.na(toto))
      all <- isNA + nonNA
      titi<-titi[!is.na(titi) & !is.na(toto)]
      titi<-titi[(titi!=0)]
      nb1 <- sum(titi==1)
      nb_court<-sum(titi<minlg & titi>1)
      nb_ok<- sum( titi>minlg-1  & titi<maxlg+1 ) 
      nb_long <-sum(titi>maxlg)
      }
      p1 = glue("<b>Situation √† <u>corriger</u> :  aucun mot ({isNA} cas) ou un seul mot ({nb1} cas) dans la description</b>")
      p2 = glue("Situation √† surveiller :  {nb_court}  descriptions une peu courtes (entre 2 et {minlg} mots)")
      p3 = glue("Situation √† surveiller :  {nb_long}  descriptions une peu longues (plus de  {maxlg} mots)")
      p4 = glue("Situation normale : {nb_ok} descriptions entre  {minlg} et  {maxlg} mots pour la nature de confidentialit√©")
      p5 = glue("(sur : {nb1+nb_ok+nb_court+nb_long} descriptions non vides au total)")
      p6 = glue("(grand total : {isNA+nb1+nb_ok+nb_court+nb_long})")
      sep="<br>"
      text<-paste(p1,p2,p3,p4,p5,p6,sep=sep )
      HTML (text)
})
```   


### Points d'attention sur Confidentialit√© en Anglais
```{r}

renderUI ({
  dico_filtre<- datafgv()
  toto<-dico_filtre[dico_filtre$`Exigence de confidentialit√© par d√©faut pouvant √™tre modifi√©e selon l'usage` %in% c("C2", "C3"), ]$`Confidentiality nature`
      isNA<-0 
      nb1<-0
      nb_ok<-0
      nb_court<-0
      nb_long<-0

    if (length(toto)>0)
    {
      minlg<-input$range[1]
      maxlg<-input$range[2]
      titi<-sapply(toto, wordcount, sep = " ")
      moy<- round(mean(titi, na.rm = T), 2)
      maxi<<- round(max(titi, na.rm = T), 2)
      mini<<- round(min(titi, na.rm = T), 2)
      isNA <<- sum(is.na(toto))
      nonNA <- sum(!is.na(toto))
      all <- isNA + nonNA
      titi<-titi[!is.na(titi) & !is.na(toto)]
      titi<-titi[(titi!=0)]
      nb1 <- sum(titi==1)
      nb_court<-sum(titi<minlg & titi>1)
      nb_ok<- sum( titi>minlg-1  & titi<maxlg+1 ) 
      nb_long <-sum(titi>maxlg)
      }
      p1 = glue("<b>Situation √† <u>corriger</u> :  aucun mot ({isNA} cas) ou un seul mot ({nb1} cas) dans la description</b>")
      p2 = glue("Situation √† surveiller :  {nb_court}  descriptions une peu courtes (entre 2 et {minlg} mots)")
      p3 = glue("Situation √† surveiller :  {nb_long}  descriptions une peu longues (plus de  {maxlg} mots)")
      p4 = glue("Situation normale : {nb_ok} descriptions entre  {minlg} et  {maxlg} mots pour la nature de confidentialit√©")
      p5 = glue("(sur : {nb1+nb_ok+nb_court+nb_long} descriptions non vides au total)")
      p6 = glue("(grand total : {isNA+nb1+nb_ok+nb_court+nb_long})")
      sep="<br>"
      text<-paste(p1,p2,p3,p4,p5,p6,sep=sep )
      HTML (text)
})
```

### Criticit√© et r√®gles m√©tier FR
```{r}
renderPlot({
    dico_filtre<- datafgv()
    #compter les RM
    toto<-dico_filtre
  toto$RM_FR<-  str_count(toto$`R√®gles de gestion m√©tier (Fran√ßais)`, "\n")+1
  toto$RM_FR[is.na(toto$`R√®gles de gestion m√©tier (Fran√ßais)`)]<-0
       p <- ggplot(toto, aes(x=`Criticit√© m√©tier`, y=RM_FR  )) +   geom_boxplot()
       p
  })
```

### Criticit√© et r√®gles m√©tier EN
```{r}
renderPlot({
    dico_filtre<- datafgv()
    #compter les RM
    toto<-dico_filtre
    toto$RM_EN<-  str_count(toto$`R√®gles de gestion m√©tier (Anglais)`, "\n")+1
    toto$RM_EN[is.na(toto$`R√®gles de gestion m√©tier (Anglais)`)]<-0
     p <- ggplot(toto, aes(x=`Criticit√© m√©tier`, y=RM_EN  )) +   geom_boxplot()
     p
  })
```


4-Longueur texte FR (DGV) {data-orientation=rows}
=====================================  
Row {data-height=100}
-------------------------------------
-------------------------------------
### Is the SCOPE
```{r}
renderValueBox({
  scope<-input$selectedDMO
  valueBox(scope,caption = "SCOPE", color=bleu(8)[1], icon = "fa-glasses")
})

```


### NBRE DONNEES ALL
```{r}
renderValueBox({
    dataset <- dataf()
    nbrdata<-dim(dataset)[1] 
  valueBox(nbrdata, caption = "Pour m√©moire : Nbr Donn√©es total",color=bleu(4)[2], icon = "fa-database")
})
```


### NBRE DONNEES GRPE Valide
```{r}
renderValueBox({
    dataset <- datafgv()
    nbrdatafiltre<-dim(dataset)[1] 
    valueBox (HTML(paste("<b><u>",nbrdatafiltre,"</b></u>")) , caption = HTML("<b><u>Assiette pour cet √©cran : Donn√©es groupe valide</b></u>"), color=bleu(4)[3], icon = "fa-award")
  })
```


### NBRE DONNEES GRPE Valide NO diffus√©e
```{r}
renderValueBox({
    dataset <- datafgvnod()
    nbrdatafiltrenod<-dim(dataset)[1] 
    valueBox(nbrdatafiltrenod, caption = "Pour info :  Donn√©es groupe valide non OBSOLETE diffus√©e", color=bleu(4)[4], icon = "fa-signal")
  })
```



Row {data-height=300}
-------------------------------------
### Nombre de mots TERME Fran√ßais
```{r}
renderPlot ({
  dico_filtre<-datafgv()
  toto<-dico_filtre$`Terme (Fran√ßais)`
  histowc(toto, title = "Nombre de mots dans le terme en Fran√ßais")
})
```

### Nombre de lettres TERME Fran√ßais
```{r}
renderPlot ({
    dico_filtre<-datafgv()
  toto<-dico_filtre$`Terme (Fran√ßais)`
  histolt(toto)
})
```   

### Points d'attention sur le terme en Fran√ßais
```{r}
sliderInput("rangeterme", "Tranche de termes acceptable FR",
                  min = 1, max = 200,
                  value = c(10,30), width = "100%")
sliderInput("rangelt", "Nb minimum de lettres du terme FR ",
                  min = 1, max = 50,
                  value = c(4), width = "100%")

renderUI ({
        mintr<-input$rangeterme[1]
      maxtr<-input$rangeterme[2]
      minlt <- input$rangelt[1]
  dico_filtre<- datafgv()
toto<-dico_filtre$`Terme (Fran√ßais)`
 titi<-sapply(toto, wordcount, sep = " ")
 moy<- round(mean(titi, na.rm = T), 2)
  maxi<<- round(max(titi, na.rm = T), 2)
  mini<<- round(min(titi, na.rm = T), 2)
  isNA <<- sum(is.na(toto))
  nonNA <- sum(!is.na(toto))
  all <- isNA + nonNA
  titi<-titi[!is.na(titi)]
  titi<-titi[(titi!=0)]
  nb1 <- sum(titi==1)
  nb_ok<- sum(titi>mintr-1 & titi<maxtr+1)
  nb_long <-sum(titi>maxtr)
  nb_court <-sum(titi<mintr)
  toto[is.na(toto)]<-"" # gerer l'absence de terme 
  titi <- nchar(toto)
  lt_court <- sum(titi<minlt)

  #### Pour les termes en fran√ßais 
  p1 = glue("Situation √† <u>corriger</u> :  aucun mot pour le terme ({isNA} cas)")
  p2 = glue("Situation √† surveiller :  {nb_long} cas de  termes une peu longs (plus de {maxtr} mots)")
  p2bis = glue("Situation √† surveiller :  {nb_court} cas de  termes une peu court (moins de {mintr} mots)")
  p3 = glue("Situation normale : {nb_ok} cas de termes entre {mintr} et {maxtr}  mots")
  p4 = glue("A surveiller √©galement :  {lt_court} termes avec moins de {minlt}  lettres")
  p5 = glue("(sur :{nb_ok+nb_long} descriptions non vides au total)")
  sep="<br>"
  text<-paste(p1,p2, p2bis,p3,p4,p5,sep=sep )
  HTML (text)
})
```   


Row {data-height=300}
-------------------------------------
### Nombre de mots  DEFINITION Fran√ßais
```{r}
renderPlot ({
    dico_filtre<-datafgv()
toto<-dico_filtre$`D√©finition (Fran√ßais)`
histowc(toto, title = "Nombre de mots dans la d√©finition en Fran√ßais")
})
```

### Nombre de lettres DEFINITION Fran√ßais
```{r}
renderPlot ({
    dico_filtre<-datafgv()
    toto<-dico_filtre$`D√©finition (Fran√ßais)`
histolt(toto)
})
```   

### Points d'attention sur la d√©finition en Fran√ßais
```{r}
sliderInput("rangedf", "Tranche de mot de la d√©finition acceptable FR",
                  min = 1, max = 500,
                  value = c(10,30), width = "100%")
sliderInput("rangedflt", "Nb minimum de lettres de la definition FR ",
                  min = 1, max = 100,
                  value = c(4), width = "100%")


renderUI ({
          mindf<-input$rangedf[1]
      maxdf<-input$rangedf[2]
      mindflt <- input$rangedflt[1]
  dico_filtre<- datafgv()
toto<-dico_filtre$`D√©finition (Fran√ßais)`
 titi<-sapply(toto, wordcount, sep = " ")
 moy<- round(mean(titi, na.rm = T), 2)
  maxi<<- round(max(titi, na.rm = T), 2)
  mini<<- round(min(titi, na.rm = T), 2)
  isNA <<- sum(is.na(toto))
  nonNA <- sum(!is.na(toto))
  all <- isNA + nonNA
  titi<-titi[!is.na(titi)]
  titi<-titi[(titi!=0)]
  nb1 <- sum(titi==1)
  nb_ok<- sum(titi>mindf-1 & titi<maxdf+1)
  nb_court<- sum(titi<mindf)
  nb_long <-sum(titi>maxdf)
  toto[is.na(toto)]<-"" # gerer l'absence de terme 
titi <- nchar(toto)
 lt_court <- sum(titi<mindflt)
  
#### Pour les d√©finitions en fran√ßais 
  p1 = glue(" Situation √† <u>corriger</u> :  aucun mot pour la d√©finition ({isNA} cas)")
  p2 = glue("Situation √† surveiller :  {nb_long} cas de definitions une peu longues (plus de {maxdf} mots)")
  p3 = glue("Situation √† surveiller :  {nb_court} cas de  d√©finitions une peu courtes (moins de {mindf} mots)")
  p4 = glue("Situation normale : {nb_ok} d√©finitions entre {mindf} et {maxdf} mots")
  p5 = glue("A surveiller √©galement : les {lt_court} d√©finitions avec moins de {mindflt} lettres")
  p6= glue("(sur : {nb_ok+nb_long+nb_court} d√©finitions non vides au total)")
  sep="<br>"
  text<-paste(p1,p2,p3,p4,p5,p6,sep=sep )
  HTML (text)
 })
``` 



4-Longueur texte UK (DGV) {data-orientation=rows}
=====================================  
Row {data-height=100}
-------------------------------------
### Is the SCOPE
```{r}
renderValueBox({
  scope<-input$selectedDMO
  valueBox(scope,caption = "SCOPE", color=bleu(8)[1], icon = "fa-glasses")
})

```


### NBRE DONNEES ALL
```{r}
renderValueBox({
    dataset <- dataf()
    nbrdata<-dim(dataset)[1] 
  valueBox(nbrdata, caption = "Pour m√©moire : Nbr Donn√©es total",color=bleu(4)[2], icon = "fa-database")
})
```


### NBRE DONNEES GRPE Valide
```{r}
renderValueBox({
    dataset <- datafgv()
    nbrdatafiltre<-dim(dataset)[1] 
    valueBox (HTML(paste("<b><u>",nbrdatafiltre,"</b></u>")) , caption = HTML("<b><u>Assiette pour cet √©cran : Donn√©es groupe valide</b></u>"), color=bleu(4)[3], icon = "fa-award")
  })
```


### NBRE DONNEES GRPE Valide NO diffus√©e
```{r}
renderValueBox({
    dataset <- datafgvnod()
    nbrdatafiltrenod<-dim(dataset)[1] 
    valueBox(nbrdatafiltrenod, caption = "Pour info :  Donn√©es groupe valide non OBSOLETE diffus√©e", color=bleu(4)[4], icon = "fa-signal")
  })
```



Row {data-height=300}
-------------------------------------
### Nombre de mots TERME Anglais
```{r}
renderPlot ({
  dico_filtre<-datafgv()
  toto<-dico_filtre$`Terme (Anglais)`
  histowc(toto, title = "Nombre de mots dans le terme en Anglais")
})
```

### Nombre de lettres TERME Anglais
```{r}
renderPlot ({
    dico_filtre<-datafgv()
  toto<-dico_filtre$`Terme (Anglais)`
  histolt(toto)
})
```   

### Points d'attention sur le terme en Anglais
```{r}

sliderInput("rangetermeEN", "Tranche de termes acceptable EN",
                  min = 1, max = 200,
                  value = c(10,30), width = "100%")
sliderInput("rangeltEN", "Nb minimum de lettres du terme EN",
                  min = 1, max = 50,
                  value = c(4), width = "100%")

renderUI ({
        mintr<-input$rangetermeEN[1]
      maxtr<-input$rangetermeEN[2]
      minlt <- input$rangeltEN[1]
  dico_filtre<- datafgv()
toto<-dico_filtre$`Terme (Anglais)`
 titi<-sapply(toto, wordcount, sep = " ")
 moy<- round(mean(titi, na.rm = T), 2)
  maxi<<- round(max(titi, na.rm = T), 2)
  mini<<- round(min(titi, na.rm = T), 2)
  isNA <<- sum(is.na(toto))
  nonNA <- sum(!is.na(toto))
  all <- isNA + nonNA
  titi<-titi[!is.na(titi)]
  titi<-titi[(titi!=0)]
  nb1 <- sum(titi==1)
  nb_ok<- sum(titi>mintr-1 & titi<maxtr+1)
  nb_long <-sum(titi>maxtr)
  nb_court <-sum(titi<mintr)
  toto[is.na(toto)]<-"" # gerer l'absence de terme 
  titi <- nchar(toto)
  lt_court <- sum(titi<minlt)

  #### Pour les termes en fran√ßais 
  p1 = glue("Situation √† <u>corriger</u> :  aucun mot pour le terme ({isNA} cas)")
  p2 = glue("Situation √† surveiller :  {nb_long} cas de  termes une peu longs (plus de {maxtr} mots)")
  p2bis = glue("Situation √† surveiller :  {nb_court} cas de  termes une peu court (moins de {mintr} mots)")
  p3 = glue("Situation normale : {nb_ok} cas de termes entre {mintr} et {maxtr}  mots")
  p4 = glue("A surveiller √©galement :  {lt_court} termes avec moins de {minlt}  lettres")
  p5 = glue("(sur :{nb_ok+nb_long} descriptions non vides au total)")
  sep="<br>"
  text<-paste(p1,p2, p2bis,p3,p4,p5,sep=sep )
  HTML (text)
})
```   


Row {data-height=300}
-------------------------------------
### Nombre de mots  DEFINITION Anglais
```{r}
renderPlot ({
    dico_filtre<-datafgv()
toto<-dico_filtre$`D√©finition (Anglais)`
histowc(toto, title = "Nombre de mots dans la d√©finition en Anglais")
})
```

### Nombre de lettres DEFINITION Anglais
```{r}
renderPlot ({
    dico_filtre<-datafgv()
    toto<-dico_filtre$`D√©finition (Anglais)`
histolt(toto)
})
```   

### Points d'attention sur la d√©finition en Anglais
```{r}

sliderInput("rangedfEN", "Tranche de mot de la d√©finition acceptable EN",
                  min = 1, max = 500,
                  value = c(10,30), width = "100%")
sliderInput("rangedfltEN", "Nb minimum de lettres de la definition EN",
                  min = 1, max = 100,
                  value = c(4), width = "100%")


renderUI ({
          mindf<-input$rangedfEN[1]
      maxdf<-input$rangedfEN[2]
      mindflt <- input$rangedfltEN[1]
      dico_filtre<- datafgv()
toto<-dico_filtre$`D√©finition (Anglais)`
 titi<-sapply(toto, wordcount, sep = " ")
 moy<- round(mean(titi, na.rm = T), 2)
  maxi<<- round(max(titi, na.rm = T), 2)
  mini<<- round(min(titi, na.rm = T), 2)
  isNA <<- sum(is.na(toto))
  nonNA <- sum(!is.na(toto))
  all <- isNA + nonNA
  titi<-titi[!is.na(titi)]
  titi<-titi[(titi!=0)]
  nb1 <- sum(titi==1)
  nb_ok<- sum(titi>mindf-1 & titi<maxdf+1)
  nb_court<- sum(titi<mindf)
  nb_long <-sum(titi>maxdf)
toto[is.na(toto)]<-"" # gerer l'absence de terme 
  titi <- nchar(toto)
 lt_court <- sum(titi<mindflt)
  
#### Pour les d√©finitions en fran√ßais 
  p1 = glue(" Situation √† <u>corriger</u> :  aucun mot pour la d√©finition ({isNA} cas)")
  p2 = glue("Situation √† surveiller :  {nb_long} cas de definitions une peu longues (plus de {maxdf} mots)")
  p3 = glue("Situation √† surveiller :  {nb_court} cas de  d√©finitions une peu courtes (moins de {mindf} mots)")
  p4 = glue("Situation normale : {nb_ok} d√©finitions entre {mindf} et {maxdf} mots")
  p5 = glue("A surveiller √©galement : les {lt_court} d√©finitions avec moins de {mindflt} lettres")
  p6= glue("(sur : {nb_ok+nb_long+nb_court} d√©finitions non vides au total)")
  sep="<br>"
  text<-paste(p1,p2,p3,p4,p5,p6,sep=sep )
  HTML (text)
 })
``` 


6-Liste de valeurs (DGV) {data-orientation=rows}
=====================================  
Row {data-height=100}
-------------------------------------
### Is the SCOPE
```{r}
renderValueBox({
  scope<-input$selectedDMO
  valueBox(scope,caption = "SCOPE", color=bleu(8)[1], icon = "fa-glasses")
})
```

### NBRE DONNEES ALL
```{r}
renderValueBox({
    dataset <- dataf()
    nbrdata<-dim(dataset)[1] 
  valueBox(nbrdata, caption = "Pour m√©moire : Nbr Donn√©es total",color=bleu(4)[2], icon = "fa-database")
})
```

### NBRE DONNEES GRPE Valide
```{r}
renderValueBox({
    dataset <- datafgv()
    nbrdatafiltre<-dim(dataset)[1] 
    valueBox (HTML(paste("<b><u>",nbrdatafiltre,"</b></u>")) , caption = HTML("<b><u>Assiette pour cet √©cran : Donn√©es groupe valide</b></u>"), color=bleu(4)[3], icon = "fa-award")
  })
```

### NBRE DONNEES GRPE Valide NO diffus√©e
```{r}
renderValueBox({
    dataset <- datafgvnod()
    nbrdatafiltrenod<-dim(dataset)[1] 
    valueBox(nbrdatafiltrenod, caption = "Pour info :  Donn√©es groupe valide non OBSOLETE diffus√©e", color=bleu(4)[4], icon = "fa-signal")
  })
```


Row {data-height=300}
-------------------------------------
### LISTE DE VALEURS Fran√ßais
```{r}
# Liste des valeurs
renderPlot({
  dico_filtre<-datafgv()
  toto<-as.data.frame(dico_filtre$`Liste de valeurs (Fran√ßais)`)
  titi<-sapply(FUN = str_count , X=toto, "\n")
  titi10 <- sum(is.na(titi))       # vide => pas de valeurs
  titi11 <- sum(titi==0,na.rm = T) # pas de saut  pas vide => 1 valeur
  titi12 <- sum(titi==1,na.rm = T) # 1 saut =>  2 valeurs
  titi13 <- sum(titi==2,na.rm = T) # 2 saut =>  3 valeurs
  tata<-titi[!is.na(titi)]   #=> l√† ou on a des valeurs
  ct_okf <- sum(titi>1 & titi<40,na.rm = T)
  ct_ckf <- sum(titi>39 & titi<100,na.rm = T)
  ct_kof <- sum(titi>99,na.rm = T)
  #summary (titi)
  if (length(tata)>0 )
  {hist(tata, breaks = 400 , main = "Nombre de valeurs", xlab = "Fran√ßais")}
  
})
```


### LISTE DE VALEURS Anglais
```{r}
# Liste des valeurs
renderPlot({
  dico_filtre<-datafgv()
  toto2<-as.data.frame(dico_filtre$`Liste de valeurs (Anglais)`)
  titi2<-sapply(FUN = str_count , X=toto2, "\n")
  titi20 <- sum(is.na(titi2))       # vide => pas de valeurs
  titi21 <- sum(titi2==0,na.rm = T) # pas de saut  pas vide => 1 valeur
  titi22 <- sum(titi2==1,na.rm = T) # 1 saut =>  2 valeurs
  titi23 <- sum(titi2==2,na.rm = T) # 2 saut =>  3 valeurs
  tata2<-titi2[!is.na(titi2)]   #=> l√† ou on a des valeurs
  ct_oke <- sum(titi2>1 & titi2<40,na.rm = T)
  ct_cke <- sum(titi2>39 & titi2<100,na.rm = T)
  ct_koe <- sum(titi2>99,na.rm = T)
    if (length(tata2)>0 )
  {hist(tata2, breaks = 400 , main = "Nombre de valeurs", xlab = "Anglais")}
  
})
```



Row {data-height=300}
-------------------------------------
### LISTES des Valeurs compar√©es Francais et Anglais
```{r}
renderPlot({
  dico_filtre<-datafgv()
  toto2<-as.data.frame(dico_filtre$`Liste de valeurs (Anglais)`)
  titi2<-sapply(FUN = str_count , X=toto2, "\n")
  toto<-as.data.frame(dico_filtre$`Liste de valeurs (Fran√ßais)`)
  titi<-sapply(FUN = str_count , X=toto, "\n")
titiall<-as.data.frame(cbind(titi,titi2))
colnames(titiall)<-c('FR','EN')
ggplot(titiall,
       aes(x=FR,
           y=EN))+
  geom_point(size=1)+
geom_abline(intercept = 0, slope = 1, color="red", size = 0.5)+
    theme_bw()
})
```

### Points d'attention
####  LISTES DE VALEURS (Fran√ßais/Anglais)
```{r}
renderUI ({
  dico_filtre<- datafgv()
   toto<-as.data.frame(dico_filtre$`Liste de valeurs (Fran√ßais)`)
  titi<-sapply(FUN = str_count , X=toto, "\n")
   ct_okf <- sum(titi>1 & titi<40,na.rm = T)
  ct_ckf <- sum(titi>39 & titi<100,na.rm = T)
  ct_kof <- sum(titi>99,na.rm = T)
  
toto2<-as.data.frame(dico_filtre$`Liste de valeurs (Anglais)`)
  titi2<-sapply(FUN = str_count , X=toto2, "\n")
    tata2<-titi2[!is.na(titi2)]   #=> l√† ou on a des valeurs
  ct_oke <- sum(titi2>1 & titi<40,na.rm = T)
  ct_cke <- sum(titi2>39 & titi<100,na.rm = T)
  ct_koe <- sum(titi2>99,na.rm = T)
  titi10 <- sum(is.na(titi))  
  titi20 <- sum(is.na(titi2)) 
   
p1 = "Pour les concepts de nature donn√©es m√©tier, on est suppos√© avoir au moins une valeur."
p2 = glue("(ici {titi10} ({titi20} en anglais) donn√©es sans valeurs toute nature confondue) ")
p3 = "Voir un analyse limit√©e aux natures 'donn√©e metier' la page 'Indicateur de compl√©tude ')<br>"
p4 = glue("Situation normale : les {ct_okf} ( {ct_oke} en anglais) concepts avec quelques valeurs (de 2 √† 40).")
p5 = glue("Situation √† <u>surveiller</u>  : les {ct_ckf} ({ct_cke} en anglais) concepts avec entre 40 et 100 valeurs.")
p6 = glue("On peut s'interroger sur les  {ct_kof} ({ct_koe} en anglais) cas avec tr√®s grand nombre de valeur de donn√©es (au dela de 100 environ) <br>")
p7 = "Par ailleurs, on peut voir si on a le m√™me nombre de valeur en Francais et en Anglais avec le nuage de points"
p8 = "(il est questionnable d'avoir des observations √©loign√©es de la 1ere bissectrice avec une diff√©rence importante entre le nombre de valeur en fran√ßais et anglais)"

 sep="<br>"
  text<-paste(p1,p2,p3,p4,p5,p6,p7,p8,sep=sep )
  HTML (text)
})
```




7-Dates (DGV) {data-orientation=rows}
=====================================  
Row {data-height=100}
-------------------------------------
### Is the SCOPE
```{r}
renderValueBox({
  scope<-input$selectedDMO
  valueBox(scope,caption = "SCOPE", color=bleu(8)[1], icon = "fa-glasses")
})
```

### NBRE DONNEES ALL
```{r}
renderValueBox({
    dataset <- dataf()
    nbrdata<-dim(dataset)[1] 
  valueBox(nbrdata, caption = "Pour m√©moire : Nbr Donn√©es total",color=bleu(4)[2], icon = "fa-database")
})
```

### NBRE DONNEES GRPE Valide
```{r}
renderValueBox({
    dataset <- datafgv()
    nbrdatafiltre<-dim(dataset)[1] 
    valueBox (HTML(paste("<b><u>",nbrdatafiltre,"</b></u>")) , caption = HTML("<b><u>Assiette pour cet √©cran : Donn√©es groupe valide</b></u>"), color=bleu(4)[3], icon = "fa-award")
  })
```

### NBRE DONNEES GRPE Valide NO diffus√©e
```{r}
renderValueBox({
    dataset <- datafgvnod()
    nbrdatafiltrenod<-dim(dataset)[1] 
    valueBox(nbrdatafiltrenod, caption = "Pour info :  Donn√©es groupe valide non OBSOLETE diffus√©e", color=bleu(4)[4], icon = "fa-signal")
  })
```


Row {data-height=300}
-------------------------------------
###  DATA CREATION
```{r}
# all dates 
renderPlot( {
  date_all = date_all()
  date.c = date_all[,"date.c"]
datedens(date.c, "Date de cr√©ation")
})

```

###  DATA VALIDATION
```{r}
# 
renderPlot( {
  date_all = date_all()
  date.v = date_all[,"date.v"]
datedens(date.v, "Date de validation")
})
```


###  DATA MODIFICATION
```{r}
# 
renderPlot( {
  date_all = date_all()
  date.m = date_all[,"date.m"]
datedens(date.m, "Date de modification")
})
```

###  DATA OBSOLETE
```{r}
# 
renderPlot( {
  date_all = date_all()
  date.o = date_all[,"date.o"]
datedens(date.o, "Date d'obsolesence")
})
```


Row {data-height=300}
-------------------------------------
###  DATA CREATION
```{r}
renderUI({
  date_all = date_all()
  date.c = date_all[,"date.c"]
df<-as.data.frame(summary(as.data.frame(date.c)))

dt_ck = sum(date.c<date(x = "2012-01-01")& date.c>=date(x = "2008-01-01"),na.rm = TRUE)
dt_ko1 = sum(date.c<date(x = "2008-01-01"),na.rm = TRUE)
dt_ko2 = sum(date.c>Sys.Date(),na.rm = TRUE)
dt_ok = sum(date.c<=Sys.Date() & date.c>=date(x = "2012-01-01"),na.rm = TRUE)

p1= glue("Les dates de cr√©ation s'√©tendent de {df[1,3]} √† {df[6,3]} <br>")
p2= glue("Situation √† corriger  :  {dt_ko1} dates ant√©rieures √† 2008 et  {dt_ko2} dates post√©rieures √† la date du jour")
p3= glue("Situation √† surveiller :   {dt_ck} dates ant√©rieures √† 2012 (tout en √©tant post√©rieures √† 2008)<br>")
p4 = glue("(sur un total de {dt_ck+dt_ko1+dt_ko2+dt_ok} dates au total)")
 sep="<br>"
  text<-paste(p1,p2,p3,p4,sep=sep )
  HTML (text)
})
```


###  DATA VALIDATION
```{r}
renderUI({
  date_all = date_all()
  date.v = date_all[,"date.v"]
df<-as.data.frame(summary(as.data.frame(date.v)))

dt_ck = sum(date.v<date(x = "2012-01-01")& date.v>=date(x = "2008-01-01"),na.rm = TRUE)
dt_ko1 = sum(date.v<date(x = "2008-01-01"),na.rm = TRUE)
dt_ko2 = sum(date.v>Sys.Date(),na.rm = TRUE)
dt_ok = sum(date.v<=Sys.Date() & date.v>=date(x = "2012-01-01"),na.rm = TRUE)
p1= glue("Les dates de validation s'√©tendent de {df[1,3]} √† {df[6,3]} <br>")
p2= glue("Situation √† corriger  :  {dt_ko1} dates ant√©rieures √† 2008 et  {dt_ko2} dates post√©rieures √† la date du jour")
p3= glue("Situation √† surveiller :   {dt_ck} dates ant√©rieures √† 2012 (tout en √©tant post√©rieures √† 2008)<br>")
p4 = glue("(sur un total de {dt_ck+dt_ko1+dt_ko2+dt_ok} dates au total)")
 sep="<br>"
  text<-paste(p1,p2,p3,p4,sep=sep )
  HTML (text)
})
```


###  DATA MODIFICATION
```{r}
renderUI({
  date_all = date_all()
  date.m = date_all[,"date.m"]
df<-as.data.frame(summary(as.data.frame(date.m)))

dt_ck = sum(date.m<date(x = "2012-01-01")& date.m>=date(x = "2008-01-01"),na.rm = TRUE)
dt_ko1 = sum(date.m<date(x = "2008-01-01"),na.rm = TRUE)
dt_ko2 = sum(date.m>Sys.Date(),na.rm = TRUE)
dt_ok = sum(date.m<=Sys.Date() & date.m>=date(x = "2012-01-01"),na.rm = TRUE)
p1= glue("Les dates de modification s'√©tendent de {df[1,3]} √† {df[6,3]} <br>")
p2= glue("Situation √† corriger  :  {dt_ko1} dates ant√©rieures √† 2008 et  {dt_ko2} dates post√©rieures √† la date du jour")
p3= glue("Situation √† surveiller :   {dt_ck} dates ant√©rieures √† 2012 (tout en √©tant post√©rieures √† 2008)<br>")
p4 = glue("(sur un total de {dt_ck+dt_ko1+dt_ko2+dt_ok} dates au total)")
 sep="<br>"
  text<-paste(p1,p2,p3,p4,sep=sep )
  HTML (text)
})
```

###  DATA OBSOLETE
```{r}
renderUI({
  date_all = date_all()
  date.o = date_all[,"date.o"]
df<-as.data.frame(summary(as.data.frame(date.o)))

dt_ck = sum(date.o<date(x = "2012-01-01")& date.o>=date(x = "2008-01-01"),na.rm = TRUE)
dt_ko1 = sum(date.o<date(x = "2008-01-01"),na.rm = TRUE)
dt_ko2 = sum(date.o>Sys.Date(),na.rm = TRUE)
dt_ok = sum(date.o<=Sys.Date() & date.o>=date(x = "2012-01-01"),na.rm = TRUE)
p1= glue("Les dates d'obsolescence s'√©tendent de {df[1,3]} √† {df[6,3]} <br>")
p2= glue("Situation √† corriger  :  {dt_ko1} dates ant√©rieures √† 2008 et  {dt_ko2} dates post√©rieures √† la date du jour")
p3= glue("Situation √† surveiller :   {dt_ck} dates ant√©rieures √† 2012 (tout en √©tant post√©rieures √† 2008)<br>")
p4 = glue("(sur un total de {dt_ck+dt_ko1+dt_ko2+dt_ok} dates au total)")
 sep="<br>"
  text<-paste(p1,p2,p3,p4,sep=sep )
  HTML (text)
})
```


8-Dates Comparaisons (DGV)  {data-orientation=rows}
=====================================  
Row {data-height=100}
-------------------------------------
### Is the SCOPE
```{r}
renderValueBox({
  scope<-input$selectedDMO
  valueBox(scope,caption = "SCOPE", color=bleu(8)[1], icon = "fa-glasses")
})
```

### NBRE DONNEES ALL
```{r}
renderValueBox({
    dataset <- dataf()
    nbrdata<-dim(dataset)[1] 
  valueBox(nbrdata, caption = "Pour m√©moire : Nbr Donn√©es total",color=bleu(4)[2], icon = "fa-database")
})
```

### NBRE DONNEES GRPE Valide
```{r}
renderValueBox({
    dataset <- datafgv()
    nbrdatafiltre<-dim(dataset)[1] 
    valueBox (HTML(paste("<b><u>",nbrdatafiltre,"</b></u>")) , caption = HTML("<b><u>Assiette pour cet √©cran : Donn√©es groupe valide</b></u>"), color=bleu(4)[3], icon = "fa-award")
  })
```

### NBRE DONNEES GRPE Valide NO diffus√©e
```{r}
renderValueBox({
    dataset <- datafgvnod()
    nbrdatafiltrenod<-dim(dataset)[1] 
    valueBox(nbrdatafiltrenod, caption = "Pour info :  Donn√©es groupe valide non OBSOLETE diffus√©e", color=bleu(4)[4], icon = "fa-signal")
  })
```


Row {data-height=250}
-------------------------------------
###  DATES CREATION-VALIDATION
```{r}
renderPlot({
  date_all = date_all()
  date.cv = date_all[,c("date.c", "date.v")]
  if (sum(!(is.na(date.cv)))>0)
  {plot(date.cv,pch = 20 , cex = 0.5)
    abline(0,1, col = 'red')
  }
})
```

###  DATES VALIDATION-MODIFICATION
```{r}
renderPlot({
  date_all = date_all()
  date.vm = date_all[,c("date.v", "date.m")]
  if (sum(!(is.na(date.vm)))>0)
  {plot(date.vm,pch = 20 , cex = 0.5)
    abline(0,1, col = 'red')}
})
```


###  DATES MODIFICATION-OBSOLETE
```{r}
renderPlot({
  date_all = date_all()
  date.om = date_all[,c("date.o", "date.m")]
if (sum(!((is.na(date.om[,1]) | is.na(date.om[,2]))))>0)
{plot(date.om,pch = 20 , cex = 0.5)
abline(0,1, col = 'red')}
})
```


Row {data-height=50}
-------------------------------------
### 
```{r}
renderUI({
  date_all = date_all()
  date.c = date_all$date.c
  date.v = date_all$date.v
  p1= glue("la date de validation doit √™tre post√©rieure √† la date de creation => les donn√©es sous la ligne rouge sont des anomalies")
  p2= glue("(on a actuellement <b> {sum(date.v<date.c, na.rm= TRUE)}</b>  cas d'anomalie)")
  sep="<br>"
  text<-paste(p1,p2,sep=sep )
  HTML (text)
})
```

###
```{r}
renderUI({
  date_all = date_all()
  date.v = date_all$date.v
  date.m = date_all$date.m
  p1= glue("la date de modification doit √™tre ant√©rieure √† la date de validation => les donn√©es au dessus la ligne rouge sont des anomalies")
  p2 = glue("(on a actuellement<b>  {sum(date.v<date.m, na.rm= TRUE)}</b>  cas d'anomalie)")
  sep="<br>"
  text<-paste(p1,p2,sep=sep )
  HTML (text)
})
```

###
```{r}
renderUI({
  date_all = date_all()
  date.o = date_all$date.o
  date.m = date_all$date.m
  p1 = glue("la date d'obsolesence doit √™tre √©gale a la date de modification => les donn√©es hors la ligne rouge sont des anomalies")
  p2 = glue("(on a actuellement <b> {sum(date.o!=date.m, na.rm= TRUE)} </b> cas d'anomalie)")
  sep="<br>"
  text<-paste(p1,p2,sep=sep )
  
  HTML (text)
})
```





Row {data-height=250}
-------------------------------------
###  DATES VALIDATION-OBSOLETE 
```{r}
renderPlot({
  date_all = date_all()
  date.ov = date_all[,c("date.o", "date.v")]
  if (sum(!(is.na(date.ov)))>0)
  {plot(date.ov,pch = 20 , cex = 0.5)
    abline(0,1, col = 'red')}
})
```

###  DATES CREATION-OBSOLETE 
```{r}
# 
renderPlot({
  date_all = date_all()
  date.co = date_all[,c("date.c", "date.o")]
  if (sum(!(is.na(date.co)))>0)
  {plot(date.co,pch = 20 , cex = 0.5)
    abline(0,1, col = 'red')}
})

```


###  DATES CREATION-MODIFICATION
```{r}
renderPlot({
  date_all = date_all()
  date.cm = date_all[,c("date.c", "date.m")]
  if (sum(!(is.na(date.cm)))>0)
  {plot(date.cm,pch = 20 , cex = 0.5)
    abline(0,1, col = 'red')}
})
```


Row {data-height=50}
-------------------------------------
###
```{r}
renderUI({
  date_all = date_all()
  date.o = date_all$date.o
  date.v = date_all$date.v
  p1 = glue("la date d'obsolesence doit √™tre post√©rieure √† la date de validation =>  les donn√©es <u>sous la ligne rouge</u> sont des anomalies")
  p2 = glue("(on a actuellement  <b> {sum(date.o<date.v, na.rm= TRUE)} </b>  cas d'anomalie)")
  sep="<br>"
  text<-paste(p1,p2,sep=sep )
    HTML (text)
})
```



###
```{r}
renderUI({
  date_all = date_all()
  date.o = date_all$date.o
  date.c = date_all$date.c
  p1 = glue("la date d'obsolesence doit √™tre post√©rieure √† la date de creation =>  les donn√©e sous la ligne rouge sont des anomalies")
  p2 = glue("(on a actuellement  <b>{sum(date.o<date.c, na.rm= TRUE)}  </b>cas d'anomalie)")
  sep="<br>"
  text<-paste(p1,p2,sep=sep )
    HTML (text)
})
```



###
```{r}
renderUI({
  date_all = date_all()
  date.m = date_all$date.m
  date.c = date_all$date.c
  p1 = glue("la date de modification doit √™tre post√©rieure √† la date de cr√©ation =>  les donn√©es sous la ligne rouge sont des anomalies")
  p2 = glue("(on a actuellement  <b>{sum(date.m<date.c, na.rm= TRUE)} </b> cas d'anomalie)")
  sep="<br>"
  text<-paste(p1,p2,sep=sep )
    HTML (text)
})
```





9-SERVICES (DO & DD) (DGV) {data-orientation=rows}
=====================================     
Row {data-height=100}
-------------------------------------
### Is the SCOPE
```{r}
renderValueBox({
  scope<-input$selectedDMO
  valueBox(scope,caption = "SCOPE", color=bleu(8)[1], icon = "fa-glasses")
})
```

### NBRE DONNEES ALL
```{r}
renderValueBox({
    dataset <- dataf()
    nbrdata<-dim(dataset)[1] 
  valueBox(nbrdata, caption = "Pour m√©moire : Nbr Donn√©es total",color=bleu(4)[2], icon = "fa-database")
})
```

### NBRE DONNEES GRPE Valide
```{r}
renderValueBox({
    dataset <- datafgv()
    nbrdatafiltre<-dim(dataset)[1] 
    valueBox (HTML(paste("<b><u>",nbrdatafiltre,"</b></u>")) , caption = HTML("<b><u>Assiette pour cet √©cran : Donn√©es groupe valide</b></u>"), color=bleu(4)[3], icon = "fa-award")
  })
```

### NBRE DONNEES GRPE Valide NO diffus√©e
```{r}
renderValueBox({
    dataset <- datafgvnod()
    nbrdatafiltrenod<-dim(dataset)[1] 
    valueBox(nbrdatafiltrenod, caption = "Pour info :  Donn√©es groupe valide non OBSOLETE diffus√©e", color=bleu(4)[4], icon = "fa-signal")
  })
```




Row {data-height=300}
-------------------------------------
### Services Data designer
```{r}
renderPlot({
  dico_filtre<-datafgv()
  toto<-table(substring(dico_filtre$`Service Business Data Designer`, 1,4))
  titi<-toto[order(-toto)]
  x<-length(titi)
  barplot(titi , cex.names=.5 ,  main= glue( "On a {x} service data designers (4 caract√®res).")) 
})
```   

###  Liste Service Data designer (complet)
```{r}
renderTable({
    dico_filtre<-datafgv()
  toto<-substring(dico_filtre$`Service Business Data Designer`, 1,100)
  titi<-unique(toto)
  toto<-table(toto)
  titi<-as.data.frame(toto[order(-toto)])
  names(titi)[1]<- "DD"
  titi  }, rownames = TRUE
)
``` 

### Noms Data designer
```{r}
renderPlot({
  dico_filtre<-datafgv()
  toto<-table(substring(dico_filtre$`Nom Business Data Designer`, 1,100))
  titi<-toto[order(-toto)]
  x<-length(titi)
  barplot(titi , cex.names=.5  , main= glue( "On a {x} data designers nomm√©s.")) 
})
```   



###  Liste Noms des Data designers
```{r}
renderTable({
  dico_filtre<-datafgv()
  toto<-substring(dico_filtre$`Nom Business Data Designer`, 1,100)
  titi<-unique(toto)
  toto<-table(toto)
  titi<-as.data.frame(toto[order(-toto)])
  names(titi)[1]<- "DD"
  titi  }, rownames = TRUE
)
``` 
  


Row {data-height=300}
-------------------------------------
### Service Data owner
```{r}
renderPlot({
  dico_filtre<-datafgv()
  toto<-table(substring(dico_filtre$`Serv Owner`, 1,4))
  titi<-toto[order(-toto)]
  x<-length(titi)
  barplot(titi , cex.names=.5 ,  main= glue( "On a {x} service data owner (4 caract√®res).")) 
})
``` 
 
### Liste Service Data owner (complet)
```{r}
renderTable({
    dico_filtre<-datafgv()
  toto<-substring(dico_filtre$`Serv Owner`, 1,100)
  titi<-unique(toto)
  toto<-table(toto)
  titi<-as.data.frame(toto[order(-toto)])
  names(titi)[1]<- "DO"
  titi  }, rownames = TRUE
)
```

### Noms Data designer
```{r}
renderPlot({
  dico_filtre<-datafgv()
  toto<-table(substring(dico_filtre$`Nom Owner`, 1,100))
  titi<-toto[order(-toto)]
  x<-length(titi)
  barplot(titi , cex.names=.5  , main= glue( "On a {x} data designers nomm√©s.")) 
})
``` 


### Liste Noms Data owner <br>Attention, si le CDO est aussi Data owner, cela doit rester une exception (dans le temps et en nombre)
```{r}
renderTable({
  dico_filtre<-datafgv()
  toto<-substring(dico_filtre$`Nom Owner`, 1,100)
  titi<-unique(toto)
  toto<-table(toto)
  titi<-as.data.frame(toto[order(-toto)])
  names(titi)[1]<- "DD"
  titi  }, rownames = TRUE
)
``` 





10 COMPLETUDE (DGV nature data) {data-orientation=rows}
=====================================     
Row {data-height=100}
-------------------------------------
### Is the SCOPE
```{r}
renderValueBox({
  scope<-input$selectedDMO
  valueBox(scope,caption = "SCOPE", color=bleu(8)[1], icon = "fa-glasses")
})
```

### NBRE DONNEES ALL
```{r}
renderValueBox({
    dataset <- dataf()
    nbrdata<-dim(dataset)[1] 
  valueBox(nbrdata, caption = "Pour m√©moire : Nbr Donn√©es total",color=bleu(4)[2], icon = "fa-database")
})
```

### NBRE DONNEES GRPE Valide
```{r}
renderValueBox({
    dataset <- datafgv()
    nbrdatafiltre<-dim(dataset)[1] 
    valueBox (HTML(paste("<b><u>",nbrdatafiltre,"</b></u>")) , caption = HTML("<b><u>Assiette pour cet √©cran : Donn√©es groupe valide</b></u>"), color=bleu(4)[3], icon = "fa-award")
  })
```

### NBRE DONNEES GRPE Valide NO diffus√©e
```{r}
renderValueBox({
    dataset <- datafgvnod()
    nbrdatafiltrenod<-dim(dataset)[1] 
    valueBox(nbrdatafiltrenod, caption = "Pour info :  Donn√©es groupe valide non OBSOLETE diffus√©e", color=bleu(4)[4], icon = "fa-signal")
  })
```





Row {data-height=100}
-------------------------------------
### 1a. Comp. Terme FR
```{r}
renderValueBox({ 
  dico_filtredm<-datafgv()
  valbox_control (dico_filtredm,vari= "Terme (Fran√ßais)" , text = "des termes en fran√ßais sont remplis")
  })

```

### 1b. Comp. Terme EN
```{r}
renderValueBox({ 
  dico_filtredm<-datafgv()
valbox_control (dico_filtredm,vari= "Terme (Anglais)" , text = "des termes en anglais sont remplis")
})
```

### 2a. Comp. Def FR
```{r}
renderValueBox({ 
  dico_filtredm<-datafgv()
valbox_control (dico_filtredm,vari= "D√©finition (Fran√ßais)" , text = "des d√©finitions en fran√ßais sont remplies")
})
```

### 2b. Comp. Def EN
```{r}
renderValueBox({ 
  dico_filtredm<-datafgv()
valbox_control (dico_filtredm,vari= "D√©finition (Anglais)" , text = "des d√©finitions en anglais sont remplies")
})
```

### 3. Comp. Criticit√© m√©tier
```{r}
renderValueBox({ 
  dico_filtredm<-datafgv()
valbox_control (dico_filtredm,vari= "Criticit√© m√©tier" , text = "des criticit√© m√©tier sont renseign√©es")
})
```


### 4. Comp. Domaine
```{r}
renderValueBox({ 
  dico_filtredm<-datafgv()
valbox_control (dico_filtredm,vari= "Nom long domaine de donn√©es (Fran√ßais)" , text = "des domaines de cartographie sont indiqu√©s")
})
```

Row {data-height=100}
-------------------------------------
### 5.Comp. Service DO
```{r}
renderValueBox({ 
  dico_filtredm<-datafgv()
  valbox_control (dico_filtredm,vari= "Serv Owner" , text = "des services de data owner sont indiqu√©s")
})
```

### 6. Comp. Nom  DO
```{r}
renderValueBox({ 
  dico_filtredm<-datafgv()
valbox_control (dico_filtredm,vari= "Nom Owner" , text = "des noms de data owner sont indiqu√©s")
})
```

### 7.Comp. Service DD
```{r}
renderValueBox({ 
  dico_filtredm<-datafgv()
valbox_control (dico_filtredm,vari= "Service Business Data Designer" , text = "des services de data designer sont indiqu√©s")
})
```

### 8.Comp. Service DO
```{r}
renderValueBox({ 
  dico_filtredm<-datafgv()
valbox_control (dico_filtredm,vari= "Nom Business Data Designer" , text = "des noms de data owner sont indiqu√©s")
})
```

### 9. Comp. Process Prod
```{r}
renderValueBox({ 
  dico_filtredm<-datafgv()
valbox_control (dico_filtredm,vari= "Processus producteurs" , text = "des processus producteur de la donn√©e sont list√©s")
})
```

### 10. Comp. Process Conso
```{r}
renderValueBox({ 
  dico_filtredm<-datafgv()
  valbox_control (dico_filtredm,vari= "Processus consommateurs" , text = "des processus consommateur de la donn√©e sont list√©s")
})
```

Row {data-height=100}
-------------------------------------
### 11. Comp. Exi Conf. 
```{r}
renderValueBox({ 
  dico_filtredm<-datafgv()
  valbox_control (dico_filtredm,vari= "Exigence de confidentialit√© par d√©faut pouvant √™tre modifi√©e selon l'usage" , text = "des exigences de confidentialit√© -C0 √† C3- sont pr√©cis√©s")
})
```

### 11. Nature de confidentialit√© (C2C3) 
```{r}
renderValueBox({
  dico_filtredmC2C3<-datafgvC2C3()
toto<-as.data.frame(table(dico_filtredmC2C3$`Nature de la confidentialit√©`))
titi<-toto[order(-toto$Freq),]
#titi$Var1
toto2<-as.data.frame(table(dico_filtredmC2C3$`Confidentiality nature`))
titi2<-toto2[order(-toto2$Freq),]

  if (length(titi)>0) {xf=100*sum(titi$Freq)/dim(dico_filtredmC2C3)[1]} else {xf=NA}
  if (length(titi2)>0) {xe=100*sum(titi2$Freq)/dim(dico_filtredmC2C3)[1]} else {xe=NA}
xf=round(xf,2 )  
xe=round(xe,2 )
  x<-sum(xf,xe, na.rm = TRUE)/2
  if (x==100) {col <- "#DBFCB9"}
  if (x<100)  {col <- "#EBF6B9"}
  if (x<75)   {col <- "#FCF0B9"}
  if (x<50)   {col <- "#FCCCB9"}
  if (x<25)   {col <- "#D2D2D2"}

text = paste ("des natures de confidentialit√© sont remplies pour les (" , dim(dico_filtredmC2C3 )[1] , "data C2C3) ")
caption = HTML(paste ("<p style = 'font-size : 20px;color:black;'><b>", xe ,"% Anglais"  ,"<br>", text ,"</b></p>" ))
value = paste0( xf,"% Fran√ßais"   ) 
valueBox(value=value,caption = caption, color=col)
})
```


###  12a. Comp. Liste Valeur FR
```{r}
renderValueBox({ 
  dico_filtredm<-datafgv()
valbox_control (dico_filtredm,vari= "Liste de valeurs (Fran√ßais)" , text = "des listes de valeurs en Fran√ßais sont renseign√©es")
})
```

### 12b. Comp. Liste Valeur EN
```{r}
renderValueBox({ 
  dico_filtredm<-datafgv()
  valbox_control (dico_filtredm,vari= "Liste de valeurs (Anglais)" , text = "des listes de valeurs en Anglais sont renseign√©es")
})
```


### 13.a Comp. Regle m√©tier FR
```{r}
renderValueBox({ 
  dico_filtredm<-datafgv()
  valbox_control (dico_filtredm,vari= "R√®gles de gestion m√©tier (Fran√ßais)" , text = "des r√®gles m√©tier en Fran√ßais sont renseign√©es")
})
```

### 13b. Comp. Regle m√©tier EN
```{r}
renderValueBox({ 
  dico_filtredm<-datafgv()
  valbox_control (dico_filtredm,vari= "R√®gles de gestion m√©tier (Anglais)" , text = "des r√®gles m√©tier en Anglais sont renseign√©es")
})
```




Row {data-height=200}
-------------------------------------


### 14. Compl. % de tout va bien
```{r}
renderValueBox({ 
  dico_filtredm<-datafgv()
valbox_control (dico_filtredm,vari= "All" , text = " de donn√©es sur les quelles tout est bon  'ALL-IS-OK'")
})
```

### Explication sur le pourcentage ALL-IS-OK (par ligne)
<p style = 'font-size : 15px;color:black;'>
Ceci est issu du nombre de lignes (de donn√©es) o√π la <u>totalit√©</u> des champs obligatoires sont remplis.<br>
Le rapport est fait en divisant pas le nombre total de donn√©es (Groupe, Valide, de nature "donn√©e m√©tier") <br>
Une donn√©e est consid√©r√©e comme not-ok d√®s qu'un des champs obligatoires n'est pas rempli.
</p>


### 14. Compl. % de moyen
```{r}
 # renderValueBox({ 
 #   x<-moyenne()
 #   if (x==100) {col <- "#DBFCB9"}
 #   if (x<100)  {col <- "#EBF6B9"}
 #   if (x<75)   {col <- "#FCF0B9"}
 #   if (x<50)   {col <- "#FCCCB9"}
 #   if (x<25)   {col <- "#D2D2D2"}
 # value = paste( round(x,2) ,"%" ) 
 # text =  "est la moyenne des taux de compl√©tude"
 # caption = HTML(paste ("<p style = color:black;'><b>", text ,"</b></p>" ))
 # valueBox(value=value,caption =caption , color=col)
 #     })

renderGauge({
   x<-moyenne()
  gauge(x,min=0, max=100,
        sectors = gaugeSectors(success = c(98, 100), 
                                 warning = c(50, 98),
                                 danger = c(0, 50)))
  })
```



### Explication sur le pourcentage moyen de compl√©tude (par colonne)
<p style = 'font-size : 15px;color:black;'>
Ceci est issu de la <u>moyenne</u> des taux de remplissage de chaque champ obligatoire.<br>
Cette moyenne est influenc√©e par les taux tr√®s bons de remplissage de champs "Terme" et "D√©finition".
</p>


Row {data-height=100}
-------------------------------------
### 13b. personnel
```{r}
renderValueBox({
  dico_filtredm<-datafgv()
#table(dico_filtredm$`Cat√©gorie de donn√©e √† caract√®re personnel`)
valbox_control (dico_filtredm,vari= "Cat√©gorie de donn√©e √† caract√®re personnel" , text = "(INFO) Cat donne√©e cara. prio. ")
})
```

### nombre de lignes ou le DD est distinct du DO
```{r}
renderValueBox({
  dico_filtredm<-datafgv()
  if (sum(is.na(dico_filtredm$`Nom Owner`))>0 ) 
  {
    dico_filtredm[is.na(dico_filtredm$`Nom Owner`),]$`Nom Owner` <- "VIDE"
  }
  if (sum(is.na(dico_filtredm$`Nom Business Data Designer`))>0 )
  {
    dico_filtredm[is.na(dico_filtredm$`Nom Business Data Designer`),]$`Nom Business Data Designer` <- "VIDE"
  }
  x = (1- sum(dico_filtredm$`Nom Business Data Designer` ==dico_filtredm$`Nom Owner` ) / dim(dico_filtredm)[1]) *100
  if (x==100) {col <- "#DBFCFF"}
  if (x<100)  {col <- "#EBF6FF"}
  if (x<75)   {col <- "#FCF0FF"}
  if (x<50)   {col <- "#FCCCFF"}
  if (x<25)   {col <- "#D2D2FF"}
  value = paste( round(x,2) ,"%" ) 
  text =  "(INFO) % de data avec DD<>DO"
  caption = HTML(paste ("<p style = color:black;'><b>", text ,"</b></p>" ))
  valueBox(value=value,caption =caption , color=col)
})
```




11- Lien Mod√®les {data-orientation=rows}
=====================================     


Row {data-height=100}
-------------------------------------
### Is the SCOPE
```{r}
renderValueBox({
  scope<-input$selectedDMO
  valueBox(scope,caption = "SCOPE", color=bleu(8)[1], icon = "fa-glasses")
})
```

### NBRE DONNEES ALL
```{r}
renderValueBox({
    dataset <- dataf()
    nbrdata<-dim(dataset)[1] 
  valueBox(nbrdata, caption = "Pour m√©moire : Nbr Donn√©es total",color=bleu(4)[2], icon = "fa-database")
})
```

### NBRE DONNEES GRPE Valide
```{r}
renderValueBox({
    dataset <- datafgv()
    nbrdatafiltre<-dim(dataset)[1] 
    valueBox (HTML(paste("<b><u>",nbrdatafiltre,"</b></u>")) , caption = HTML("<b><u>Assiette pour cet √©cran : Donn√©es groupe valide</b></u>"), color=bleu(4)[3], icon = "fa-award")
  })
```

### NBRE DONNEES GRPE Valide NO diffus√©e
```{r}
renderValueBox({
    dataset <- datafgvnod()
    nbrdatafiltrenod<-dim(dataset)[1] 
    valueBox(nbrdatafiltrenod, caption = "Pour info :  Donn√©es groupe valide non OBSOLETE diffus√©e", color=bleu(4)[4], icon = "fa-signal")
  })
```





   
Row {data-height=300}
-------------------------------------

### valuebox sur MODEL
```{r}
renderValueBox({
    dico_filtre <- datafgv()
    # nombre de concept AVEC entit√© / sans ENTITE 
    #is.na(dico_filtre[dico_filtre$`Concept ADD` == "Actif financier",]$`Entit√©es m√©tier li√©es`)
    toto<-dim(dico_filtre)[1]
    titi<-sum(!is.na(dico_filtre$`Entit√©es m√©tier li√©es`)|!is.na(dico_filtre$`Attributs m√©tier li√©s`))
    x<-titi/toto*100
    col <- gris(3)[3]
    value = paste( round(x,2) ,"%" ) 
    text =  "des data utilis√©es dans des mod√®les m√©tier"
    caption = HTML(paste ("<p style = 'font-size : 35px;color:black;'><b>", text ,"</b></p>" ))
    valueBox(value=value,caption =caption , color=col)
})
``` 


### valuebox sur EM
```{r}
renderValueBox({
    dico_filtre <- datafgv()
    # nombre de concept AVEC entit√© / sans ENTITE 
    #is.na(dico_filtre[dico_filtre$`Concept ADD` == "Actif financier",]$`Entit√©es m√©tier li√©es`)
    toto<-dim(dico_filtre)[1]
    titi<-sum(!is.na(dico_filtre$`Entit√©es m√©tier li√©es`))
    x<-titi/toto*100
    col <- gris(3)[2]
    value = paste( round(x,2) ,"%" ) 
    text =  "des data utilis√©es comme entit√© m√©tier dans un mod√®le m√©tier"
    caption = HTML(paste ("<p style = 'font-size : 25px;color:black;'><b>", text ,"</b></p>" ))
    valueBox(value=value,caption =caption , color=col)
})
```   
 
### Nature DM/OM/CM et usage mod√®les
```{r}
renderValueBox({
    dico_filtre <- datafgv()
    # nombre de concept AVEC ATTRIBUT / sans ATTRIBUTS
    toto<-dim(dico_filtre)[1]
    titi<-sum(!is.na(dico_filtre$`Attributs m√©tier li√©s`))
    x<-titi/toto*100
    col <- gris(3)[1]
    value = paste( round(x,2) ,"%" ) 
    text =  "des data utilis√©es comme attributs m√©tier dans un mod√®le m√©tier"
    caption = HTML(paste ("<p style = 'font-size : 25px;color:black;'><b>", text ,"</b></p>" ))
    valueBox(value=value,caption =caption , color=col)
})
```




### Donn√©es du dictionnaire utilis√©es dans les mod√®les M√©tier
```{r}
renderTable({
    dico_filtre <- datafgv()
    # nombre de DM/OM/CM utilis√© comme ENTITE ou ATTRIBUT
    dico_filtre$AM<-""
    if (sum(!is.na(dico_filtre$`Attributs m√©tier li√©s`)) >0)
    {dico_filtre[!is.na(dico_filtre$`Attributs m√©tier li√©s`) ,]$AM<-"AM!"}
    dico_filtre$EM<-""
    if  (sum(!is.na(dico_filtre$`Entit√©es m√©tier li√©es` )) >0) 
    {dico_filtre[!is.na(dico_filtre$`Entit√©es m√©tier li√©es`),]$EM<-"EM!"}
    dico_filtre$EMAM <- "NUL"
    dico_filtre$EMAM <- paste (dico_filtre$AM,  dico_filtre$EM)
    as.data.frame.matrix(addmargins(table(dico_filtre$Nature, dico_filtre$EMAM,useNA = "always" )))
}, rownames = TRUE)
```
#### Explication sur relation en nature tet usage mod√®les
<p style = 'font-size : 15px;color:black;'>
blah blah blah</p>





Row {data-height=300}
-----------------------------------------------------------------------

### Usage en mod√®le IT 
```{r}
renderValueBox({
    dico_filtre <- datafgv()
    # nombre de concept AVEC entit√© / sans ENTITE 
    #is.na(dico_filtre[dico_filtre$`Concept ADD` == "Actif financier",]$`Entit√©es m√©tier li√©es`)
    totoEA<-dim(dico_filtre)[1]
    titiEA<-sum(!is.na(dico_filtre$`Entit√©s applicatives li√©es`)|!is.na(dico_filtre$`Attributs applicatifs li√©es`))
    x<-titiEA/totoEA*100
    col <- bleu(3)[3]
    value = paste( round(x,2) ,"%" ) 
    text =  "des data utilis√©es dans un mod√®le IT "
    caption = HTML(paste ("<p style = 'font-size : 35px;color:black;'><b>", text ,"</b></p>" ))
    valueBox(value=value,caption =caption , color=col)
})
```

### Usage en mod√®le IT (entit√©)
```{r}
renderValueBox({
    dico_filtre <- datafgv()
    # nombre de concept AVEC entit√© / sans ENTITE 
    #is.na(dico_filtre[dico_filtre$`Concept ADD` == "Actif financier",]$`Entit√©es m√©tier li√©es`)
    totoEA<-dim(dico_filtre)[1]
    titiEA<-sum(!is.na(dico_filtre$`Entit√©s applicatives li√©es`))
    x<-titiEA/totoEA*100
    col <- bleu(3)[2]
    value = paste( round(x,2) ,"%" ) 
    text =  "des data utilis√©es comme entit√© applicative dans un mod√®le IT "
    caption = HTML(paste ("<p style = 'font-size : 25px;color:black;'><b>", text ,"</b></p>" ))
    valueBox(value=value,caption =caption , color=col)
})
```

### Usage en mod√®le IT (attribut)
```{r}
renderValueBox({
    dico_filtre <- datafgv()
    # nombre de concept AVEC ATTRIBUT / sans ATTRIBUTS
    totoAA<-dim(dico_filtre)[1]
    titiAA<-sum(!is.na(dico_filtre$`Attributs applicatifs li√©es`))
    x<-titiAA/totoAA*100
    col <- bleu(3)[1]
    value = paste( round(x,2) ,"%" ) 
    text =  "des data utilis√©es comme attributs applicatif dans un mod√®le IT"
    caption = HTML(paste ("<p style = 'font-size : 25px;color:black;'><b>", text ,"</b></p>" ))
    valueBox(value=value,caption =caption , color=col)
})
```


### Donn√©es du dictionnaire utilis√©es dans les mod√®les IT
```{r}
renderTable({
    dico_filtre <- datafgv()
    # nombre de DM/OM/CM utilis√© comme ENTITE ou ATTRIBUT
    dico_filtre$AA<-""
    if (sum(!is.na(dico_filtre$`Attributs applicatifs li√©es`)) >0)
    {dico_filtre[!is.na(dico_filtre$`Attributs applicatifs li√©es`) ,]$AA<-"AA!"}
    dico_filtre$EA<-""
    if  (sum(!is.na(dico_filtre$`Entit√©s applicatives li√©es` )) >0) 
    {dico_filtre[!is.na(dico_filtre$`Entit√©s applicatives li√©es`),]$EA<-"EA!"}
    dico_filtre$EAAA <- "NUL"
    dico_filtre$EAAA <- paste (dico_filtre$AA,  dico_filtre$EA)
    
    as.data.frame.matrix(addmargins(table(dico_filtre$Nature, dico_filtre$EAAA,useNA = "always" )))
    
}, rownames = TRUE)
```

#### Explication sur relation en nature tet usage mod√®les applicatifs
<p style = 'font-size : 15px;color:black;'>
blah blah blah</p>





<!-- ### **Box plot** shows the relationship between categorical and numeric variables -->
<!-- ```{r} -->

<!-- renderPlotly({ -->
<!--   plot_ly(data, -->
<!--           x = ~data[[input$numeric_variable]], -->
<!--           color = ~data[[input$categorical_variable]], -->
<!--           colors = "Paired", -->
<!--           type = "box") %>% -->
<!--     layout(title = "", -->
<!--            xaxis = list(title = "" , -->
<!--                         zeroline = FALSE)) -->
<!-- }) -->
<!-- ``` -->

<!-- Row {data-height=100} -->
<!-- ------------------------------------- -->

<!-- ### **Bar chart** shows the distribution of categorical veriable -->
<!-- ```{r} -->

<!-- renderPlotly({ -->
<!--   data %>% -->
<!--     count(var = data[[input$categorical_variable]], name = "count") %>% -->
<!--     plot_ly( x = ~var, y = ~ count, type = "bar", marker = list(color = '#008ae6', -->
<!--                                                                 line = list(color = '#008ae6', width = 2)), hoverinfo = "x+y") %>% -->
<!--     add_text(text = ~paste0( " (",   scales::percent(count/sum(count)),")"),  -->
<!--              textposition = "bottom",  -->
<!--              textfont = list(size = 12, color = "white"),  -->
<!--              showlegend = FALSE) %>% -->
<!--     layout(xaxis = list(title = ""), yaxis = list(title = "")) -->

<!-- }) -->
<!-- ``` -->

<!-- ### **Histogram** shows the distribution of numeric variable -->
<!-- ```{r} -->

<!-- renderPlotly({ -->
<!--   plot_ly(x = data[[input$numeric_variable]], type = "histogram",  marker = list(color = "#008ae6", -->
<!--                                                                                  line = list(color = "darkgray", -->
<!--                                                                                              width = 1))) -->
<!-- }) -->
<!-- ``` -->
